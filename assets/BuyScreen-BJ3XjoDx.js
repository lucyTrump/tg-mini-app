import{aN as nt,aO as At,aP as xe,aQ as Wt,g as st,aR as Bt,b as Qe,aS as j,aT as t,aU as vt,aV as d,aW as It,aX as Et,aY as Ft,aZ as b,a_ as it,a$ as Y,b0 as $,b1 as Rt,b2 as Dt,b3 as ke,b4 as at,b5 as ot,b6 as N,b7 as zt,a6 as me,b8 as ue,b9 as Ce,ba as q,bb as J,bc as h,bd as Se,be as v,bf as Te,bg as he,bh as x,bi as Ae,bj as K,bk as ee,bl as ge,bm as P,bn as We,bo as Ot,bp as X,bq as V,br as pt,bs as ye,bt as Be,L as ce,K as Pt,bu as $e,bv as Mt,aA as Lt,bw as Nt,bx as qt,by as _t,bz as Ut,bA as ct,bB as Ht,bC as rt,bD as Qt,bE as $t,bF as Gt,bG as dt,bH as Vt,bI as Kt,bJ as fe,bK as Yt,bL as Zt,bM as lt,bN as Jt,bO as Xt,bP as Ge,bQ as ut,bR as en,bS as tn,bT as ht,bU as nn,bV as Ve,bW as sn,bX as xt,bY as an,bZ as te,b_ as mt,b$ as yt,c0 as on,c1 as cn,d as Ke,aa as rn,c2 as dn,c3 as ln,c4 as Ye,c5 as un,c6 as hn,c7 as ft,c8 as xn,c9 as mn,ca as yn,cb as fn,cc as jn,cd as jt,ce as gn,cf as bn,cg as wn,ch as kn,ci as Ze,cj as Cn,ck as Sn,cl as Tn,cm as An,cn as Wn,co as Bn,cp as vn}from"./index-DAt5dF0_.js";async function Je(e){const n=await nt(e);return At(n)}function In(e,n){return xe({...n,queryKey:["buyWithCryptoQuote",e],queryFn:()=>{if(!e)throw new Error("Swap params are required");return Wt(e)},enabled:!!e,retry(s,a){if(s>3)return!1;try{if(a.error.code==="MINIMUM_PURCHASE_AMOUNT")return!1}catch{return!0}return!0}})}async function En(e){try{const s=await st(e.client)(Bt(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({toAddress:e.toAddress,fromCurrencySymbol:e.fromCurrencySymbol,toChainId:e.toChainId.toString(),toTokenAddress:e.toTokenAddress,fromAmount:e.fromAmount,toAmount:e.toAmount,maxSlippageBPS:e.maxSlippageBPS,isTestMode:e.isTestMode,purchaseData:e.purchaseData,fromAddress:e.fromAddress,toGasAmountWei:e.toGasAmountWei})});if(!s.ok){const a=await s.json();throw a&&"error"in a?a:new Error(`HTTP error! status: ${s.status}`)}return(await s.json()).result}catch(n){throw console.error("Error getting buy with fiat quote",n),n}}function Fn(e,n){return xe({...n,queryKey:["useBuyWithFiatQuote",e],queryFn:async()=>{if(!e)throw new Error("No params provided");return En(e)},enabled:!!e,retry(s,a){if(s>3)return!1;try{if(a.error.code==="MINIMUM_PURCHASE_AMOUNT")return!1}catch{return!0}return!0}})}function gt(e){const n=e.toToken.chainId===e.onRampToken.token.chainId,s=Qe(e.toToken.tokenAddress)===Qe(e.onRampToken.token.tokenAddress);return!(n&&s)}const bt=j.forwardRef(function(n,s){return t.jsx(Rn,{ref:s,children:t.jsx(vt,{children:t.jsxs(d,{p:"lg",children:[t.jsx(It,{children:t.jsx(Et,{type:"button","aria-label":"Close",onClick:n.close,children:t.jsx(Ft,{width:b.md,height:b.md,style:{color:"inherit"}})})}),n.children]})})})}),Rn=it(e=>{const n=Y();return{zIndex:1e4,borderTopLeftRadius:$.xl,borderTopRightRadius:$.xl,background:n.colors.modalBg,position:"absolute",bottom:0,left:0,right:0,animation:`${Dn} 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.1)`,borderTop:`1px solid ${n.colors.borderColor}`}}),Dn=Rt`
  from {
    opacity: 0;
    transform: translateY(100px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
`,wt=it(e=>({backgroundColor:Y().colors.modalOverlayBg,zIndex:9999,position:"absolute",inset:0,animation:`${Dt} 400ms cubic-bezier(0.16, 1, 0.3, 1)`}));function kt(){const[e,n]=j.useState(!1),s=j.useRef(null),a=j.useRef(null),i=j.useCallback(()=>new Promise(l=>{var c;if(s.current){const o={easing:"cubic-bezier(0.175, 0.885, 0.32, 1.1)",fill:"forwards",duration:300},r=s.current.animate([{transform:"translateY(100%)",opacity:0}],o);(c=a.current)==null||c.animate([{opacity:0}],o),r.onfinish=()=>l()}else l()}),[]),u=j.useCallback(async l=>{l?n(!0):(await i(),n(!1))},[i]);return j.useLayoutEffect(()=>{if(!e)return;const l=c=>{s.current&&c.target instanceof Node&&!s.current.contains(c.target)&&u(!1)};return requestAnimationFrame(()=>{document.addEventListener("click",l)}),()=>{document.removeEventListener("click",l)}},[e,u]),{drawerRef:s,drawerOverlayRef:a,setIsOpen:u,isOpen:e}}function zn(e){var k,F,T,f,O,R;const{payUiOptions:n,supportedDestinations:s,client:a,onContinue:i,payerAccount:u}=e,l=Y(),c=ke(),o=n.metadata,r=n.paymentInfo,{data:y}=at(r.chain),{data:A}=ot({client:a,address:r.sellerAddress}),w=xe({queryKey:["amount",r],queryFn:async()=>{let I=18;r.token&&!N(r.token)&&(I=await zt({contract:me({address:r.token.address,chain:r.chain,client:a})}));let z;return"amountWei"in r?z=ue(r.amountWei,I):z=r.amount,z}}).data;if(!y||w===void 0)return t.jsx(Ce,{});const g=r.token?{...r.token,icon:((k=r.token)==null?void 0:k.icon)||((T=(F=s.find(I=>I.chain.id===r.chain.id))==null?void 0:F.tokens.find(I=>{var z;return I.address.toLowerCase()===((z=r.token)==null?void 0:z.address.toLowerCase())}))==null?void 0:T.icon)}:{address:q,name:y.nativeCurrency.name,symbol:y.nativeCurrency.symbol,icon:(f=y.icon)==null?void 0:f.url};return t.jsxs(d,{p:"lg",children:[t.jsx(J,{title:(o==null?void 0:o.name)||"Payment Details"}),t.jsx(h,{y:"lg"}),t.jsxs(d,{children:[o!=null&&o.image?t.jsx(Se,{client:a,src:o==null?void 0:o.image,style:{width:"100%",borderRadius:v.md,backgroundColor:l.colors.tertiaryBg}}):c?t.jsxs(d,{flex:"row",center:"both",style:{padding:v.md,marginBottom:v.md,borderRadius:v.md,backgroundColor:l.colors.tertiaryBg},children:[t.jsx(Te,{size:b.xl,id:c.id,client:a}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:l.colors.secondaryIconColor,marginLeft:v.md,marginRight:v.md}}),t.jsx(he,{client:a,size:b.xl,chainIconUrl:(O=y.icon)==null?void 0:O.url})]}):null,t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Ae,{chain:r.chain,client:e.client,size:"sm",token:g}),t.jsxs(x,{color:"primaryText",size:"md",weight:700,children:[String(K(Number(w),6))," ",g.symbol]})]})})]}),t.jsx(h,{y:"md"}),t.jsx(ee,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(he,{chainIconUrl:(R=y.icon)==null?void 0:R.url,size:"xs",client:e.client}),t.jsx(x,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:y.name})]})})]}),t.jsx(h,{y:"sm"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"xs",color:"secondaryText",children:"Seller"})}),t.jsx(d,{expand:!0,children:t.jsx(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(x,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:A||ge(r.sellerAddress)})})})]})]}),t.jsx(h,{y:"xl"}),u?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{i(w,r.chain,g)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(We,{...e.connectOptions,client:a,theme:l,connectButton:{style:{width:"100%"}}})})]})}function Ct(e){const{estimatedSeconds:n,quoteIsLoading:s}=e;return t.jsxs(d,{bg:"tertiaryBg",flex:"row",borderColor:"borderColor",style:{borderRadius:$.md,borderTopLeftRadius:0,borderTopRightRadius:0,justifyContent:"space-between",alignItems:"center",borderWidth:"1px",borderStyle:"solid"},children:[t.jsxs(d,{flex:"row",center:"y",gap:"xxs",color:"accentText",p:"sm",children:[t.jsx(Ot,{width:b.sm,height:b.sm}),s?t.jsx(X,{height:V.xs,width:"50px",color:"borderColor"}):t.jsx(x,{size:"xs",color:"secondaryText",children:n!==void 0?`~${pt(n)}`:"--"})]}),t.jsxs(P,{variant:"ghost",onClick:e.onViewFees,gap:"xs",children:[t.jsx(d,{color:"accentText",flex:"row",center:"both",children:t.jsx(On,{size:b.sm})}),t.jsx(x,{size:"xs",color:"secondaryText",children:"View Fees"})]})]})}const On=e=>t.jsxs("svg",{width:e.size,height:e.size,viewBox:"0 0 12 12",fill:"none",xmlns:"http://www.w3.org/2000/svg","aria-hidden":"true",children:[t.jsx("path",{d:"M9.5 1.5H2.5C1.94772 1.5 1.5 1.94772 1.5 2.5V9.5C1.5 10.0523 1.94772 10.5 2.5 10.5H9.5C10.0523 10.5 10.5 10.0523 10.5 9.5V2.5C10.5 1.94772 10.0523 1.5 9.5 1.5Z",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),t.jsx("path",{d:"M4.5 7.5L7.5 4.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]});function pn(e){return t.jsxs(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderRadius:$.md,borderBottomRightRadius:0,borderBottomLeftRadius:0,borderWidth:"1px",borderStyle:"solid",borderBottom:"none",flexWrap:"nowrap",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs(Pn,{variant:"ghost",onClick:e.onSelectCurrency,style:{minHeight:"64px",justifyContent:"flex-start",minWidth:"50%"},gap:"sm",children:[t.jsx(e.currency.icon,{size:b.md}),t.jsxs(d,{flex:"row",center:"y",gap:"xxs",color:"secondaryText",children:[t.jsx(x,{color:"primaryText",children:e.currency.shorthand}),t.jsx(ye,{width:b.sm,height:b.sm})]})]}),t.jsx("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:v.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:v.sm},children:e.isLoading?t.jsx(X,{width:"100px",height:V.lg}):t.jsx(x,{size:"lg",color:e.value?"primaryText":"secondaryText",children:e.value?`${K(Number(e.value),6)}`:"--"})})]})}const Pn=Be(P)(()=>({"&[disabled]:hover":{borderColor:"transparent"}}));function Mn(e){const{transaction:n,account:s,supportedDestinations:a}=e,[i,u]=j.useState();return j.useEffect(()=>{Promise.all([ce(n.value),ce(n.erc20Value),ce(n.to),Pt(n)]).then(([l,c,o,r])=>{var y;u({value:l==null?void 0:l.toString(),erc20Value:(y=c==null?void 0:c.amountWei)==null?void 0:y.toString(),erc20Currency:c==null?void 0:c.tokenAddress,to:o,data:r})})},[n]),xe({queryKey:["transaction-cost",n.chain.id,s==null?void 0:s.address,i],queryFn:async()=>{var m,w,g;if(!s)throw new Error("No account");const l=await ce(n.erc20Value);if(l){const[k,F,T]=await Promise.all([$e({address:s.address,chain:n.chain,client:n.client,tokenAddress:l.tokenAddress}),Mt({contract:me({address:l.tokenAddress,chain:n.chain,client:n.client})}),be(n,s==null?void 0:s.address)]),f=l.amountWei,O=k;return{token:{address:l.tokenAddress,name:F.name,symbol:F.symbol,icon:(w=(m=a.find(I=>I.chain.id===n.chain.id))==null?void 0:m.tokens.find(I=>I.address.toLowerCase()===l.tokenAddress.toLowerCase()))==null?void 0:w.icon},decimals:F.decimals,walletBalance:O,gasCostWei:T,transactionValueWei:f}}const[c,o,r]=await Promise.all([$e({address:s.address,chain:n.chain,client:n.client}),Lt(n.chain),be(n,s==null?void 0:s.address)]),y=c,A=await ce(n.value)||0n;return{token:{address:q,name:o.nativeCurrency.name,symbol:o.nativeCurrency.symbol,icon:(g=o.icon)==null?void 0:g.url},decimals:18,walletBalance:y,gasCostWei:r,transactionValueWei:A}},enabled:!!n&&!!s&&!!i,refetchInterval:()=>{if(!n.erc20Value)return 3e4}})}async function be(e,n){try{const s=await Nt({transaction:e,from:n}),a=s.wei/10n;return s.wei+a}catch{return n?await be(e):2000000n*await qt({client:e.client,chain:e.chain})}}function Ln(e){var m,w;const{payUiOptions:n,client:s,payerAccount:a,supportedDestinations:i,onContinue:u}=e,{data:l}=at(n.transaction.chain),c=n.metadata,{data:o}=Mn({transaction:n.transaction,account:a,supportedDestinations:i}),r=Y(),y=ke(),A=_t(y);return!o||!l?t.jsx(Ce,{}):t.jsxs(d,{p:"lg",children:[t.jsx(J,{title:(c==null?void 0:c.name)||"Transaction"}),t.jsx(h,{y:"lg"}),t.jsxs(d,{children:[c!=null&&c.image?t.jsx(Se,{client:s,src:c==null?void 0:c.image,style:{width:"100%",borderRadius:v.md,backgroundColor:r.colors.tertiaryBg}}):y?t.jsxs(d,{flex:"row",center:"both",style:{padding:v.md,marginBottom:v.md,borderRadius:v.md,backgroundColor:r.colors.tertiaryBg},children:[t.jsx(Te,{size:b.xl,id:y.id,client:s}),t.jsx("div",{style:{flexGrow:1,borderBottom:"6px dotted",borderColor:r.colors.secondaryIconColor,marginLeft:v.md,marginRight:v.md}}),t.jsx(he,{client:s,size:b.xl,chainIconUrl:(m=l.icon)==null?void 0:m.url})]}):null,t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"md",color:"primaryText",weight:700,children:"Price"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(Ae,{chain:n.transaction.chain,client:e.client,size:"sm",token:o.token}),t.jsxs(x,{color:"primaryText",size:"md",weight:700,children:[String(K(Number(ue(o.transactionValueWei,o.decimals)),6))," ",o.token.symbol]})]})})]}),t.jsx(h,{y:"md"}),t.jsx(ee,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"xs",color:"secondaryText",children:"Gas Fees"})}),t.jsx(d,{expand:!0,children:t.jsx(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:t.jsx(x,{color:A?"success":"primaryText",size:"xs",children:A?"Sponsored":`${String(K(Number(ue(o.gasCostWei,l.nativeCurrency.decimals)),6))} ${l.nativeCurrency.symbol}`})})})]}),t.jsx(h,{y:"sm"}),t.jsxs(d,{flex:"row",children:[t.jsx(d,{flex:"column",expand:!0,children:t.jsx(x,{size:"xs",color:"secondaryText",children:"Network"})}),t.jsx(d,{expand:!0,children:t.jsxs(d,{flex:"row",gap:"xs",center:"y",style:{justifyContent:"right"},children:[t.jsx(he,{chainIconUrl:(w=l.icon)==null?void 0:w.url,size:"xs",client:e.client}),t.jsx(x,{size:"xs",color:"secondaryText",style:{textAlign:"right"},children:l.name})]})})]})]}),t.jsx(h,{y:"xl"}),a?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{let g=o.transactionValueWei;o.token.address===q&&!A&&(g+=o.gasCostWei),u(ue(g,o.decimals),n.transaction.chain,o.token)},children:"Choose Payment Method"}):t.jsx("div",{children:t.jsx(We,{...e.connectOptions,client:s,theme:r,connectButton:{style:{width:"100%"}}})})]})}function St(e){const n=Y();return t.jsx(d,{bg:"tertiaryBg",style:{borderRadius:$.lg,border:`1px solid ${n.colors.borderColor}`,...e.containerStyle},children:t.jsxs(P,{fullWidth:!0,disabled:e.disabled,onClick:e.onClick,variant:"ghost",style:{justifyContent:"space-between",padding:v.sm,backgroundColor:n.colors.tertiaryBg},gap:"sm",children:[t.jsx(we,{client:e.client,address:e.address}),!e.disableChevron&&t.jsx(ye,{width:b.sm,height:b.sm,style:{color:n.colors.secondaryText}}),e.checked&&t.jsx(Ut,{width:b.md,height:b.md})]})})}function we(e){const{client:n,address:s}=e,i=ct().find(r=>{var y;return((y=r.getAccount())==null?void 0:y.address)===e.address}),u=e.walletId||(i==null?void 0:i.id),l=ot({client:n,address:s}),c=l.data||ge(s),o=Ht({client:n,ensName:l.data});return t.jsxs(d,{flex:"row",center:"y",gap:"sm",color:"secondaryText",children:[o.data?t.jsx(Se,{src:o.data,width:b.md,height:b.md,style:{borderRadius:$.sm},client:e.client}):u?t.jsx(Te,{id:u,size:b.md,client:e.client}):null,t.jsx(x,{size:"sm",color:"primaryText",children:c||ge(e.address)})]})}function Nn(e){return t.jsxs(d,{children:[t.jsx(d,{p:"lg",children:t.jsx(J,{title:"Pay with",onBack:e.onBack})}),t.jsx(ee,{}),t.jsx(h,{y:"lg"}),t.jsx(d,{flex:"column",gap:"xs",px:"lg",children:rt.map(n=>t.jsxs(qn,{fullWidth:!0,variant:"secondary",onClick:()=>e.onSelect(n),gap:"sm",children:[t.jsx(n.icon,{size:b.lg}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(x,{color:"primaryText",children:n.shorthand}),t.jsx(x,{size:"sm",children:n.name})]})]},n.shorthand))}),t.jsx(h,{y:"lg"})]})}const qn=Be(P)(()=>{const e=Y();return{background:e.colors.tertiaryBg,justifyContent:"flex-start",gap:v.sm,padding:v.sm,"&:hover":{background:e.colors.secondaryButtonBg,transform:"scale(1.01)"},transition:"background 200ms ease, transform 150ms ease"}});function Tt(e,n){const i=(window.innerHeight-750)/2,u=(window.innerWidth-500)/2;return window.open(`${e}&theme=${n}`,"thirdweb Pay",`width=500, height=750, top=${i}, left=${u}`)}function _n(e){var o,r,y,A;const n=Qt(),{openedWindow:s,onSuccess:a}=e,i=$t({intentId:e.intentId,client:e.client});let u="loading";((o=i.data)==null?void 0:o.status)==="ON_RAMP_TRANSFER_FAILED"||((r=i.data)==null?void 0:r.status)==="PAYMENT_FAILED"?u="failed":((y=i.data)==null?void 0:y.status)==="CRYPTO_SWAP_FALLBACK"?u="partialSuccess":((A=i.data)==null?void 0:A.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(u="completed");const l=j.useRef(!1);j.useEffect(()=>{var m;l.current||!a||((m=i.data)==null?void 0:m.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(l.current=!0,a(i.data))},[a,i.data]),j.useEffect(()=>{var m,w;!s||!i.data||(((m=i.data)==null?void 0:m.status)==="CRYPTO_SWAP_REQUIRED"||((w=i.data)==null?void 0:w.status)==="ON_RAMP_TRANSFER_COMPLETED")&&s.close()},[i.data,s]);const c=j.useRef(!1);return j.useEffect(()=>{var m;!c.current&&((m=i.data)==null?void 0:m.status)==="ON_RAMP_TRANSFER_COMPLETED"&&(c.current=!0,Gt(n))},[i.data,n]),j.useEffect(()=>{var m;((m=i.data)==null?void 0:m.status)==="CRYPTO_SWAP_REQUIRED"&&e.onShowSwapFlow(i.data)},[i.data,e.onShowSwapFlow]),t.jsxs(d,{p:"lg",children:[t.jsx(J,{title:e.title,onBack:e.onBack}),e.hasTwoSteps&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"lg"}),t.jsx(dt,{steps:2,currentStep:1}),t.jsx(h,{y:"sm"}),t.jsxs(x,{size:"xs",children:["Step 1 of 2 - Buying ",e.quote.onRampToken.token.symbol," with"," ",e.quote.fromCurrencyWithFees.currencySymbol]})]}),t.jsx(Un,{uiStatus:u,onDone:e.onDone,fiatStatus:i.data,client:e.client,transactionMode:e.transactionMode,quote:e.quote,isEmbed:e.isEmbed})]})}function Un(e){const{uiStatus:n}=e,s=e.fiatStatus?Vt(e.fiatStatus):void 0,a=e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"?e.fiatStatus:void 0,i=e.quote.onRampToken,u=t.jsx(Kt,{client:e.client,token:a!=null&&a.source?{chainId:a.source.token.chainId,address:a.source.token.tokenAddress,symbol:a.source.token.symbol||"",amount:a.source.amount}:{chainId:i.token.chainId,address:i.token.tokenAddress,symbol:i.token.symbol,amount:i.amount},fiat:{amount:e.quote.fromCurrencyWithFees.amount,currencySymbol:e.quote.fromCurrencyWithFees.currencySymbol},statusMeta:a!=null&&a.source&&s?{color:s==null?void 0:s.color,text:s==null?void 0:s.status,txHash:a.source.transactionHash}:void 0});return t.jsxs(d,{children:[t.jsx(h,{y:"xl"}),n==="loading"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",children:t.jsx(fe,{size:"xxl",color:"accentText"})}),t.jsx(h,{y:"md"}),t.jsx(x,{color:"primaryText",size:"lg",center:!0,children:"Buy Pending"}),t.jsx(h,{y:"sm"}),!Yt()&&t.jsx(x,{center:!0,children:"Complete the purchase in popup"}),t.jsx(h,{y:"xxl"}),u]}),n==="failed"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",children:t.jsx(Zt,{size:b["3xl"]})}),t.jsx(h,{y:"lg"}),t.jsx(x,{color:"primaryText",size:"lg",center:!0,children:"Transaction Failed"}),t.jsx(h,{y:"xxl"}),u]}),n==="completed"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"md"}),t.jsx(d,{flex:"row",center:"x",color:"success",children:t.jsx(lt,{width:b["3xl"],height:b["3xl"]})}),t.jsx(h,{y:"md"}),t.jsx(x,{color:"primaryText",size:"lg",center:!0,children:"Buy Complete"}),e.fiatStatus&&e.fiatStatus.status!=="NOT_FOUND"&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"xxl"}),u,t.jsx(h,{y:"sm"})]}),!e.isEmbed&&t.jsx(P,{variant:"accent",fullWidth:!0,onClick:e.onDone,children:e.transactionMode?"Continue Transaction":"Done"})]})]})}function Hn(e){const n=gt(e.quote),[s,a]=j.useState(n?{id:"step-1"}:{id:"onramp-status"}),[i,u]=j.useState(e.openedWindow),l=j.useCallback(()=>{Jt({intentId:e.quote.intentId,client:e.client}).then(c=>{e.onSuccess(c)})},[e.onSuccess,e.quote.intentId,e.client]);return s.id==="step-1"?t.jsx(Xt,{title:e.title,client:e.client,onBack:e.onBack,partialQuote:Ge(e.quote),step:1,onContinue:()=>{const c=Tt(e.quote.onRampLink,e.theme);ut({type:"fiat",intentId:e.quote.intentId}),u(c),a({id:"onramp-status"})}}):s.id==="onramp-status"?t.jsx(_n,{title:e.title,client:e.client,intentId:e.quote.intentId,onBack:e.onBack,hasTwoSteps:n,openedWindow:i,quote:e.quote,onDone:e.onDone,onShowSwapFlow:c=>{a({id:"postonramp-swap",data:c})},transactionMode:e.transactionMode,isEmbed:e.isEmbed,onSuccess:e.onSuccess}):s.id==="postonramp-swap"?t.jsx(en,{title:e.title,status:s.data,quote:Ge(e.quote),client:e.client,onBack:e.onBack,onDone:e.onDone,onSwapFlowStarted:()=>{},transactionMode:e.transactionMode,isEmbed:e.isEmbed,payer:e.payer,onSuccess:l}):null}function Qn(e){const{payOptions:n,supportedDestinations:s,toChain:a,toToken:i}=e;function u(){const A=s.find(g=>g.chain.id===a.id);if(!A)return{fiat:!1,swap:!1};const m=N(i)?q:i.address,w=A.tokens.find(g=>g.address.toLowerCase()===m.toLowerCase());return w?{fiat:w.buyWithFiatEnabled,swap:w.buyWithCryptoEnabled}:{fiat:!0,swap:!0}}const{fiat:l,swap:c}=u(),o=n.buyWithFiat!==!1&&l,r=n.buyWithCrypto!==!1&&c;return{buyWithFiatEnabled:o,buyWithCryptoEnabled:r,showPaymentSelection:o&&r}}const Xe=tn({id:137,name:"Polygon",nativeCurrency:{name:"MATIC",symbol:"MATIC",decimals:18},blockExplorers:[{name:"PolygonScan",url:"https://polygonscan.com",apiUrl:"https://api.polygonscan.com/api"}]});function $n(e){var I,z,W,L,C,E,U,_,p,H,M;const n=ht(),{payOptions:s,supportedDestinations:a}=e,i=s==null?void 0:s.prefillBuy,u=(i==null?void 0:i.amount)||"",[l,c]=j.useState(u),o=nn(l,300),[r,y]=j.useState((i==null?void 0:i.chain)||s.mode==="transaction"&&((I=s.transaction)==null?void 0:I.chain)||s.mode==="direct_payment"&&((z=s.paymentInfo)==null?void 0:z.chain)||((W=a.find(Q=>Q.chain.id===(n==null?void 0:n.id)))==null?void 0:W.chain)||Xe),[A,m]=j.useState((i==null?void 0:i.token)||s.mode==="direct_payment"&&s.paymentInfo.token||Ve),[w,g]=j.useState(s.buyWithCrypto!==!1&&((C=(L=s.buyWithCrypto)==null?void 0:L.prefillSource)==null?void 0:C.chain)||s.mode==="transaction"&&((E=s.transaction)==null?void 0:E.chain)||s.mode==="direct_payment"&&((U=s.paymentInfo)==null?void 0:U.chain)||Xe),[k,F]=j.useState(s.buyWithCrypto!==!1&&((p=(_=s.buyWithCrypto)==null?void 0:_.prefillSource)==null?void 0:p.token)||s.mode==="direct_payment"&&s.paymentInfo.token||Ve),f=(s.buyWithFiat!==!1?(M=(H=s.buyWithFiat)==null?void 0:H.prefillSource)==null?void 0:M.currency:void 0)||Gn(),[O,R]=j.useState(rt.find(Q=>Q.shorthand===f)||sn);return{tokenAmount:l,setTokenAmount:c,toChain:r,setToChain:y,deferredTokenAmount:o,fromChain:w,setFromChain:g,toToken:A,setToToken:m,fromToken:k,setFromToken:F,selectedCurrency:O,setSelectedCurrency:R}}function Gn(){try{const e=Intl.DateTimeFormat().resolvedOptions().timeZone.toLowerCase();return e.includes("london")?"GBP":e.includes("europe")?"EUR":e.includes("japan")?"JPY":e.includes("canada")?"CAD":"USD"}catch{return"USD"}}function Vn(e){return e.length>10?"26px":e.length>6?"34px":"50px"}function Kn(e){const{name:n}=xt(e.chain),s=()=>{let a=e.value.replace(".","").length;return e.value.includes(".")&&(a+=.3),`calc(${`${Math.max(1,a)}ch`} + 6px)`};return t.jsxs(d,{children:[t.jsx("div",{onClick:a=>{var i;(i=a.currentTarget.querySelector("input"))==null||i.focus()},children:t.jsxs(d,{flex:"row",center:"both",gap:"xs",style:{flexWrap:"nowrap"},children:[t.jsx(an,{variant:"outline",pattern:"^[0-9]*[.,]?[0-9]*$",inputMode:"decimal",tabIndex:-1,placeholder:"0",type:"text","data-placeholder":e.value==="",value:e.value||"0",disabled:e.freezeAmount,onClick:a=>{e.value===""&&a.currentTarget.setSelectionRange(a.currentTarget.value.length,a.currentTarget.value.length)},onChange:a=>{let i=a.target.value;i.startsWith(".")&&(i=`0${i}`);const u=Number(i);Number.isNaN(u)||(i.startsWith("0")&&!i.startsWith("0.")?e.onChange(i.slice(1)):e.onChange(i))},style:{border:"none",fontSize:Vn(e.value),boxShadow:"none",borderRadius:"0",padding:"0",paddingBlock:"2px",fontWeight:600,textAlign:"right",width:s(),maxWidth:"calc(100% - 100px)"}}),t.jsx(te,{token:e.token,chain:e.chain,size:"lg",color:"secondaryText"})]})}),!e.hideTokenSelector&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"sm"}),t.jsx(d,{flex:"row",center:"x",children:t.jsxs(Yn,{variant:"secondary",fullWidth:!0,style:{fontSize:V.sm},gap:"xxs",onClick:e.onSelectToken,disabled:e.freezeChainAndToken,children:[t.jsxs(d,{flex:"row",center:"y",gap:"sm",children:[t.jsx(Ae,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(d,{flex:"column",style:{gap:"4px"},children:[t.jsx(te,{token:e.token,chain:e.chain,size:"sm"}),n?t.jsx(x,{size:"xs",color:"secondaryText",children:n}):t.jsx(X,{width:"90px",height:V.xs})]})]}),t.jsx(ye,{width:b.sm,height:b.sm,style:{marginLeft:"auto"}})]})})]})]})}const Yn=Be(P)(()=>{const e=Y();return{background:e.colors.tertiaryBg,border:`1px solid ${e.colors.borderColor}`,justifyContent:"flex-start",transition:"background 0.3s",padding:v.sm}}),Zn=e=>t.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 18 18",width:e.size,height:e.size,role:"presentation",children:t.jsx("path",{fill:"currentColor",d:"M15.6 4.6H1.85v-.55l12.1-.968v.968h1.65V2.4c0-1.21-.98-2.059-2.177-1.888L2.378 2.089C1.18 2.26.2 3.39.2 4.6v11a2.2 2.2 0 002.2 2.2h13.2a2.2 2.2 0 002.2-2.2V6.8a2.2 2.2 0 00-2.2-2.2zm-1.65 7.707a1.65 1.65 0 01-.63-3.176 1.65 1.65 0 11.63 3.176z"})});function Jn(e){const{name:n}=xt(e.chain),s=mt({address:e.payerAccount.address,chain:e.chain,tokenAddress:N(e.token)?void 0:e.token.address,client:e.client});return t.jsxs(d,{bg:"tertiaryBg",borderColor:"borderColor",flex:"row",style:{borderWidth:"1px",borderTopWidth:0,borderStyle:"solid",flexWrap:"nowrap",justifyContent:"space-between",minHeight:"64px",alignItems:"center",...e.swapRequired?{borderBottom:"none"}:{borderBottomLeftRadius:$.md,borderBottomRightRadius:$.md}},children:[t.jsxs(P,{variant:"ghost",onClick:e.onSelectToken,gap:"sm",style:{paddingInline:v.sm,paddingBlock:v.sm,minWidth:"50%",justifyContent:"flex-start"},disabled:e.freezeChainAndTokenSelection,children:[t.jsx(yt,{token:e.token,chain:e.chain,size:"md",client:e.client}),t.jsxs(d,{flex:"column",gap:"3xs",children:[t.jsxs(d,{flex:"row",gap:"xs",center:"y",color:"primaryText",children:[t.jsx(te,{token:e.token,chain:e.chain,size:"sm"}),t.jsx(ye,{width:b.sm,height:b.sm})]}),n?t.jsx(x,{size:"xs",children:n}):t.jsx(X,{width:"90px",height:V.xs})]})]}),t.jsxs("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",alignItems:"flex-end",gap:v.xxs,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",justifyContent:"center",paddingRight:v.sm},children:[e.isLoading?t.jsx(X,{width:"120px",height:V.md,color:"borderColor"}):t.jsx(x,{size:"md",color:e.value?"primaryText":"secondaryText",style:{},children:K(Number(e.value),6)||""}),t.jsxs(d,{flex:"row",gap:"xxs",center:"y",color:"secondaryText",children:[t.jsx(Zn,{size:V.xs}),s.data?t.jsx(x,{size:"xs",color:"secondaryText",weight:500,children:on(s.data,!1)}):t.jsx(X,{width:"70px",height:V.xs})]})]})]})}async function Xn(e){try{const s=await st(e.client)(cn(),{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify({fromAddress:e.fromAddress,toAddress:e.toAddress,chainId:e.chainId,tokenAddress:e.tokenAddress,amount:e.amount,purchaseData:e.purchaseData})});if(!s.ok){const u=await s.json();throw u&&"error"in u?u:new Error(`HTTP error! status: ${s.status}`)}const a=(await s.json()).result;return{transactionRequest:{chain:Ke(a.transactionRequest.chainId),client:e.client,data:a.transactionRequest.data,to:a.transactionRequest.to,value:BigInt(a.transactionRequest.value),gas:BigInt(a.transactionRequest.gasLimit)},approval:a.approval?rn({contract:me({client:e.client,address:a.approval.tokenAddress,chain:Ke(a.approval.chainId)}),spender:a.approval.spenderAddress,amountWei:BigInt(a.approval.amountWei)}):void 0,fromAddress:a.fromAddress,toAddress:a.toAddress,paymentToken:a.paymentToken,processingFee:a.processingFee,estimatedGasCostUSDCents:a.estimatedGasCostUSDCents,client:e.client}}catch(n){throw console.error("Error getting buy with crypto transfer",n),n}}function es(e){const{title:n,onBack:s,receiverAddress:a,client:i,payer:u,onDone:l,chain:c,token:o,tokenAmount:r,transactionMode:y,setTransactionHash:A}=e,[m,w]=j.useState("transfer"),[g,k]=j.useState("idle"),{symbol:F}=dn(c);return t.jsxs(d,{p:"lg",children:[t.jsx(J,{title:n,onBack:s}),t.jsx(h,{y:"xl"}),y&&t.jsxs(t.Fragment,{children:[t.jsx(dt,{steps:2,currentStep:m==="transfer"?1:2}),t.jsx(h,{y:"sm"}),t.jsx(x,{size:"sm",children:m==="transfer"?"Step 1 of 2 - Transfer funds":"Step 2 of 2 - Finalize transaction"}),t.jsx(h,{y:"xl"})]}),t.jsxs(d,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t.jsx(x,{size:"sm",children:"From"}),t.jsx(we,{address:u.account.address,client:i})]}),t.jsx(h,{y:"md"}),t.jsx(ee,{}),t.jsx(h,{y:"md"}),t.jsxs(d,{flex:"row",center:"y",style:{justifyContent:"space-between"},children:[t.jsx(x,{size:"sm",children:"To"}),t.jsx(we,{address:a,client:i})]}),t.jsx(h,{y:"md"}),t.jsx(ee,{}),t.jsx(h,{y:"md"}),t.jsx(ln,{chainId:c.id,client:i,label:"Amount",tokenAmount:r,tokenSymbol:N(o)?F||"":o.symbol,tokenAddress:N(o)?q:o.address}),t.jsx(h,{y:"lg"}),y&&t.jsxs(t.Fragment,{children:[t.jsx(h,{y:"sm"}),t.jsxs(d,{gap:"sm",flex:"row",style:{justifyContent:"space-between"},center:"y",color:"accentText",children:[t.jsx(Ye,{isDone:m==="execute",isActive:m==="transfer",label:m==="transfer"?"Transfer":"Done"}),t.jsx(un,{}),t.jsx(Ye,{isDone:!1,label:"Finalize",isActive:m==="execute"})]}),t.jsx(h,{y:"lg"})]}),g==="error"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{flex:"row",gap:"xs",center:"both",color:"danger",children:[t.jsx(hn,{width:b.sm,height:b.sm}),t.jsx(x,{color:"danger",size:"sm",children:m==="transfer"?"Failed to Transfer":"Failed to Execute"})]}),t.jsx(h,{y:"md"})]}),!y&&m==="execute"&&g==="done"&&t.jsxs(t.Fragment,{children:[t.jsxs(d,{flex:"row",gap:"xs",center:"both",color:"success",children:[t.jsx(lt,{width:b.sm,height:b.sm}),t.jsx(x,{color:"success",size:"sm",children:"Payment completed"})]}),t.jsx(h,{y:"md"})]}),u.chain.id!==c.id?t.jsx(ft,{fullWidth:!0,variant:"accent",switchChain:async()=>{await e.payer.wallet.switchChain(c)}}):t.jsxs(P,{variant:"accent",fullWidth:!0,disabled:g==="pending",onClick:async()=>{if(m==="execute"){l();return}try{if(k("pending"),y){const T=N(o)?xn({client:i,chain:c,to:a,value:mn(r)}):yn({contract:me({address:o.address,chain:c,client:i}),to:a,amount:r});await Je({account:e.payer.account,transaction:T}),w("execute"),k("idle")}else{const T=await Xn({client:i,fromAddress:u.account.address,toAddress:a,chainId:c.id,tokenAddress:N(o)?q:o.address,amount:r,purchaseData:void 0});console.log("transferResponse",T),T.approval&&(w("approve"),await Je({account:e.payer.account,transaction:T.approval})),w("transfer");const f=T.transactionRequest,O=await nt({account:e.payer.account,transaction:f});A(O.transactionHash),k("idle")}}catch(T){console.error(T),k("error")}},gap:"xs",children:[m==="execute"&&(g==="done"?"Done":"Continue"),m==="transfer"&&(g==="pending"?"Confirming":"Confirm"),m==="approve"&&(g==="pending"?"Approving":"Approve"),g==="pending"&&t.jsx(fe,{size:"sm",color:"accentButtonText"})]})]})}function ts(e){const[n,s]=j.useState();return n?t.jsx(fn,{title:e.title,onBack:e.onBack,onTryAgain:e.onTryAgain,swapTxHash:n,client:e.client,onDone:e.onDone,transactionMode:!1,isEmbed:e.isEmbed,quote:void 0,onSuccess:e.onSuccess}):t.jsx(es,{...e,setTransactionHash:s})}function ns(e){var i;const n=Y(),s=ct(),a=!e.showAllWallets&&((i=e.wallets)==null?void 0:i.every(u=>s.includes(u)));return t.jsxs(d,{children:[t.jsxs(d,{flex:"column",gap:"xs",children:[s.map(u=>{var c;const l=(c=u.getAccount())==null?void 0:c.address;return t.jsx(St,{walletId:u.id,client:e.client,address:l||"",onClick:()=>{e.onSelect(u),e.onBack()},disableChevron:!0,checked:!1},u.id)}),!a&&t.jsx(P,{variant:"secondary",fullWidth:!0,onClick:e.onConnect,gap:"xs",bg:"tertiaryBg",style:{borderRadius:$.lg,border:`1px solid ${n.colors.borderColor}`,padding:v.sm},children:t.jsxs(d,{flex:"row",gap:"sm",center:"y",expand:!0,children:[t.jsx(jn,{width:b.md,height:b.md}),t.jsx(x,{size:"sm",color:"primaryText",children:"Add Another Wallet"})]})})]}),t.jsx(h,{y:"sm"})]})}function ss(){const e=ke(),n=jt(),s=ht(),[a,i]=j.useState();return j.useEffect(()=>{const c=a==null?void 0:a.wallet;function o(){if(!c){i(void 0);return}const r=c.getAccount(),y=c.getChain();r&&y?(console.log("updated to",r,y),i({account:r,chain:y,wallet:c})):i(void 0)}if(c){const r=c.subscribe("chainChanged",o),y=c.subscribe("accountChanged",o);return()=>{r(),y()}}},[a]),{payer:a||(n&&s&&e?{account:n,chain:s,wallet:e}:void 0),setPayer:i}}function hs(e){const n=gn(e.client);return n.data?t.jsx(is,{...e,supportedDestinations:n.data}):t.jsx(Ce,{})}function is(e){var re,ne,se,ie,ae,oe,G,de,je,le,ve,Ie,Ee,Fe,Re,De,ze,Oe,pe,Pe,Me,Le,Ne,qe,_e,Ue,He;const{client:n,supportedDestinations:s,connectLocale:a,payOptions:i}=e,u=jt(),{payer:l,setPayer:c}=ss(),[o,r]=j.useState({id:"main"}),[y,A]=j.useState(!1),m=j.useCallback(()=>{r({id:"main"}),e.onDone()},[e.onDone]),{tokenAmount:w,setTokenAmount:g,toChain:k,setToChain:F,deferredTokenAmount:T,fromChain:f,setFromChain:O,toToken:R,setToToken:I,fromToken:z,setFromToken:W,selectedCurrency:L,setSelectedCurrency:C}=$n({payOptions:i,supportedDestinations:s}),E=bn({client:e.client,destinationChainId:k.id,destinationTokenAddress:N(R)?q:R.address}),U=j.useMemo(()=>et(s,i,e.supportedTokens),[e.supportedTokens,s,i]),_=j.useMemo(()=>{if(E.data)return et(E.data,i,e.supportedTokens)},[e.supportedTokens,E.data,i]),p=Qn({payOptions:e.payOptions,supportedDestinations:e.supportedDestinations,toChain:k,toToken:R}),H=p.showPaymentSelection===!1&&p.buyWithCryptoEnabled===!1&&p.buyWithFiatEnabled===!1,M=j.useCallback(B=>{var D,S;(S=(D=e.payOptions).onPurchaseSuccess)==null||S.call(D,{type:"crypto",status:B})},[e.payOptions.onPurchaseSuccess]),Q=j.useCallback(B=>{var D,S;(S=(D=e.payOptions).onPurchaseSuccess)==null||S.call(D,{type:"fiat",status:B})},[e.payOptions.onPurchaseSuccess]);if(o.id==="connect-payer-wallet")return t.jsx(wn,{accountAbstraction:(re=e.connectOptions)==null?void 0:re.accountAbstraction,appMetadata:(ne=e.connectOptions)==null?void 0:ne.appMetadata,chain:(se=e.connectOptions)==null?void 0:se.chain,chains:(ie=e.connectOptions)==null?void 0:ie.chains,client:e.client,connectLocale:e.connectLocale,isEmbed:e.isEmbed,onBack:()=>r(o.backScreen),onSelect:B=>{const D=B.getAccount(),S=B.getChain();B&&D&&S&&c({account:D,chain:S,wallet:B})},recommendedWallets:(ae=e.connectOptions)==null?void 0:ae.recommendedWallets,showAllWallets:((oe=e.connectOptions)==null?void 0:oe.showAllWallets)===void 0?!0:(G=e.connectOptions)==null?void 0:G.showAllWallets,walletConnect:(de=e.connectOptions)==null?void 0:de.walletConnect,wallets:(je=e.connectOptions)==null?void 0:je.wallets});if(o.id==="swap-flow"&&l)return t.jsx(kn,{title:e.title,transactionMode:i.mode==="transaction",isEmbed:e.isEmbed,client:n,onBack:()=>{r({id:"buy-with-crypto"})},buyWithCryptoQuote:o.quote,payer:l,isFiatFlow:!1,onDone:m,onTryAgain:()=>{r({id:"buy-with-crypto"})},onSuccess:M});if(o.id==="fiat-flow"&&l)return t.jsx(Hn,{title:e.title,transactionMode:i.mode==="transaction",quote:o.quote,onBack:()=>{r({id:"buy-with-fiat"})},client:n,testMode:e.payOptions.buyWithFiat!==!1&&((le=e.payOptions.buyWithFiat)==null?void 0:le.testMode)===!0,theme:typeof e.theme=="string"?e.theme:e.theme.type,openedWindow:o.openedWindow,onDone:m,isEmbed:e.isEmbed,payer:l,onSuccess:Q});if(o.id==="transfer-flow"&&l&&u){const B=()=>r({id:"buy-with-crypto"}),S=((Ie=(ve=e.payOptions)==null?void 0:ve.paymentInfo)==null?void 0:Ie.sellerAddress)||u.address;return t.jsx(ts,{title:e.title,onBack:B,payer:l,client:e.client,chain:k,token:R,tokenAmount:w,receiverAddress:S,transactionMode:e.payOptions.mode==="transaction",isEmbed:e.isEmbed,onDone:m,onTryAgain:()=>{r({id:"buy-with-crypto"})},onSuccess:M})}if(o.id==="select-currency"){const B=()=>r(o.backScreen);return t.jsx(Nn,{onSelect:D=>{B(),C(D)},onBack:B})}if(o.id==="select-to-token"){const B=s.map(Z=>Z.chain),D=()=>r(o.backScreen),S=(Ee=i==null?void 0:i.prefillBuy)==null?void 0:Ee.allowEdits;return(S==null?void 0:S.token)===!1?t.jsx(tt,{chains:B,client:e.client,connectLocale:e.connectLocale,setChain:F,goBack:D}):t.jsx(Ze,{onBack:D,tokenList:((k!=null&&k.id?U[k.id]:void 0)||[]).filter(Z=>Z.address!==q),onTokenSelect:Z=>{I(Z),D()},chain:k,chainSelection:(S==null?void 0:S.chain)!==!1?{chains:B,select:Z=>{F(Z)}}:void 0,connectLocale:a,client:n,modalTitle:e.title})}if(o.id==="select-from-token"&&E.data&&_){const B=E.data.map(S=>S.chain),D=()=>r(o.backScreen);return i.buyWithCrypto!==!1&&((De=(Re=(Fe=i.buyWithCrypto)==null?void 0:Fe.prefillSource)==null?void 0:Re.allowEdits)==null?void 0:De.token)===!1?t.jsx(tt,{chains:B,client:e.client,connectLocale:e.connectLocale,setChain:O,goBack:D}):t.jsx(Ze,{onBack:D,tokenList:((f!=null&&f.id?_[f.id]:void 0)||[]).filter(S=>S.address!==q),onTokenSelect:S=>{W(S),D()},chain:f,chainSelection:i.buyWithCrypto!==!1&&((pe=(Oe=(ze=i.buyWithCrypto)==null?void 0:ze.prefillSource)==null?void 0:Oe.allowEdits)==null?void 0:pe.chain)!==!1?{chains:E.data.map(S=>S.chain),select:S=>O(S)}:void 0,connectLocale:a,client:n,modalTitle:"Pay with"})}return t.jsx(d,{animate:"fadein",children:t.jsxs("div",{children:[o.id==="main"&&t.jsx(os,{title:e.title,payerAccount:l==null?void 0:l.account,client:n,onSelectBuyToken:()=>r({id:"select-to-token",backScreen:o}),payOptions:i,setTokenAmount:g,setToChain:F,setToToken:I,setFromChain:O,setFromToken:W,toChain:k,toToken:R,tokenAmount:w,connectOptions:e.connectOptions,setScreen:r,supportedDestinations:s,onBack:e.onBack,theme:e.theme,hasEditedAmount:y,setHasEditedAmount:A,enabledPaymentMethods:p}),(o.id==="select-payment-method"||o.id==="select-wallet"||o.id==="buy-with-crypto"||o.id==="buy-with-fiat")&&l&&t.jsxs(cs,{title:e.title,selectedChain:k,selectedToken:R,tokenAmount:w,client:n,onBack:()=>{p.showPaymentSelection&&(o.id==="select-wallet"||o.id==="buy-with-fiat")?r({id:"select-payment-method"}):o.id==="buy-with-crypto"?r({id:"select-wallet"}):r({id:"main"})},children:[o.id==="select-payment-method"&&t.jsx(rs,{setScreen:B=>r({id:B})}),o.id==="select-wallet"&&t.jsx(ns,{client:n,onSelect:B=>{const D=B.getChain(),S=B.getAccount();D&&S&&(c({account:S,chain:D,wallet:B}),r({id:"buy-with-crypto"}))},showAllWallets:!!((Pe=e.connectOptions)!=null&&Pe.showAllWallets),wallets:(Me=e.connectOptions)==null?void 0:Me.wallets,onBack:()=>{},onConnect:()=>{r({id:"connect-payer-wallet",backScreen:{id:"select-wallet"}})},selectedAddress:l.account.address}),o.id==="buy-with-crypto"&&u&&t.jsx(ds,{setScreen:r,tokenAmount:T,toChain:k,toToken:R,fromChain:f,fromToken:z,showFromTokenSelector:()=>{r({id:"select-from-token",backScreen:o})},payer:l,client:n,isEmbed:e.isEmbed,onDone:m,payOptions:i,connectLocale:a,connectOptions:e.connectOptions,setPayer:c,activeAccount:u,setTokenAmount:g,setHasEditedAmount:A,disableTokenSelection:H===!0||i.buyWithCrypto!==!1&&((qe=(Ne=(Le=i.buyWithCrypto)==null?void 0:Le.prefillSource)==null?void 0:Ne.allowEdits)==null?void 0:qe.chain)===!1&&((He=(Ue=(_e=i.buyWithCrypto)==null?void 0:_e.prefillSource)==null?void 0:Ue.allowEdits)==null?void 0:He.token)===!1}),o.id==="buy-with-fiat"&&t.jsx(ls,{setScreen:r,tokenAmount:T,toChain:k,toToken:R,selectedCurrency:L,client:n,isEmbed:e.isEmbed,onDone:m,payOptions:i,theme:e.theme,showCurrencySelector:()=>{r({id:"select-currency",backScreen:o})},payer:l,setTokenAmount:g,setHasEditedAmount:A})]})]})})}function as(e){return t.jsx("div",{children:t.jsxs(d,{flex:"row",gap:"sm",center:"y",style:{justifyContent:"space-between"},children:[t.jsxs(d,{flex:"row",gap:"xs",center:"y",children:[t.jsx(x,{color:"primaryText","data-testid":"tokenAmount",size:"xl",children:K(Number(e.tokenAmount),6)}),t.jsxs(d,{flex:"row",gap:"xxs",center:"y",children:[t.jsx(te,{token:e.selectedToken,chain:e.selectedChain,size:"md",color:"secondaryText"}),t.jsx(yt,{chain:e.selectedChain,client:e.client,size:"sm",token:e.selectedToken})]})]}),t.jsx(vn,{chain:e.selectedChain,client:e.client,size:"sm",short:!0})]})})}function os(e){var f,O,R,I,z,W;const{setTokenAmount:n,setToChain:s,setToToken:a,setFromChain:i,setFromToken:u,payerAccount:l,client:c,tokenAmount:o,payOptions:r,toToken:y,toChain:A,supportedDestinations:m,enabledPaymentMethods:w}=e,{showPaymentSelection:g,buyWithCryptoEnabled:k,buyWithFiatEnabled:F}=w,T=!o;switch(r.mode){case"transaction":return t.jsx(Ln,{supportedDestinations:m,payUiOptions:r,payerAccount:l,connectOptions:e.connectOptions,client:c,onContinue:(L,C,E)=>{n(L),s(C),i(C),u(E),a(E),g?e.setScreen({id:"select-payment-method"}):k?e.setScreen({id:"select-wallet"}):F?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});case"direct_payment":return t.jsx(zn,{client:c,payUiOptions:r,payerAccount:l,connectOptions:e.connectOptions,supportedDestinations:m,onContinue:(L,C,E)=>{n(L),s(C),i(C),u(E),a(E),g?e.setScreen({id:"select-payment-method"}):k?e.setScreen({id:"buy-with-crypto"}):F?e.setScreen({id:"buy-with-fiat"}):e.setScreen({id:"select-wallet"})}});default:return t.jsxs(d,{p:"lg",children:[t.jsx(J,{title:e.title,onBack:e.onBack}),t.jsx(h,{y:"xl"}),t.jsx(Kn,{value:o,onChange:async L=>{e.setHasEditedAmount(!0),n(L)},freezeAmount:((O=(f=r.prefillBuy)==null?void 0:f.allowEdits)==null?void 0:O.amount)===!1,freezeChainAndToken:((I=(R=r.prefillBuy)==null?void 0:R.allowEdits)==null?void 0:I.chain)===!1&&((W=(z=r.prefillBuy)==null?void 0:z.allowEdits)==null?void 0:W.token)===!1,token:y,chain:A,onSelectToken:e.onSelectBuyToken,client:e.client}),t.jsx(h,{y:"xl"}),t.jsx(d,{flex:"column",gap:"sm",children:l?t.jsx(P,{variant:"accent",fullWidth:!0,disabled:T,"data-disabled":T,onClick:()=>{g?e.setScreen({id:"select-payment-method"}):k?e.setScreen({id:"buy-with-crypto"}):F?e.setScreen({id:"buy-with-fiat"}):console.error("No payment method enabled")},children:"Continue"}):t.jsx("div",{children:t.jsx(We,{...e.connectOptions,client:e.client,theme:e.theme,connectButton:{style:{width:"100%"}}})})})]})}}function cs(e){return t.jsxs(d,{children:[t.jsx(d,{p:"lg",children:t.jsx(J,{title:e.title,onBack:e.onBack})}),t.jsxs(d,{px:"lg",style:{paddingBottom:v.lg},children:[t.jsx(h,{y:"xs"}),t.jsx(as,{selectedToken:e.selectedToken,selectedChain:e.selectedChain,tokenAmount:e.tokenAmount,client:e.client}),t.jsx(h,{y:"md"}),t.jsx(ee,{}),t.jsx(h,{y:"lg"}),t.jsx(x,{size:"sm",children:" Pay with "}),t.jsx(h,{y:"sm"}),e.children]})]})}function rs(e){return t.jsx(d,{animate:"fadein",children:t.jsxs(d,{flex:"column",gap:"sm",children:[t.jsxs(P,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("buy-with-fiat"),gap:"sm",style:{justifyContent:"flex-start",textAlign:"left"},children:[t.jsx(d,{color:"secondaryText",flex:"row",center:"both",children:t.jsx(Cn,{style:{width:b.md,height:b.md}})}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(x,{size:"md",color:"primaryText",children:"Credit Card"}),t.jsx(x,{size:"xs",children:"Securely pay with credit card"})]})]}),t.jsxs(P,{variant:"outline",bg:"tertiaryBg",onClick:()=>e.setScreen("select-wallet"),style:{justifyContent:"flex-start"},gap:"sm",children:[t.jsx(d,{color:"secondaryText",flex:"row",center:"both",children:t.jsx(Sn,{size:b.md})}),t.jsxs(d,{flex:"column",gap:"xxs",children:[t.jsx(x,{size:"md",color:"primaryText",children:"Crypto"}),t.jsx(x,{size:"xs",children:"Pay with your connected wallet"})]})]})]})})}function ds(e){var ne,se,ie,ae,oe;const{setScreen:n,payer:s,client:a,toChain:i,tokenAmount:u,toToken:l,fromChain:c,fromToken:o,showFromTokenSelector:r,payOptions:y,disableTokenSelection:A}=e,w=((se=(ne=e.payOptions)==null?void 0:ne.paymentInfo)==null?void 0:se.sellerAddress)||e.activeAccount.address,{drawerRef:g,drawerOverlayRef:k,isOpen:F,setIsOpen:T}=kt(),[f,O]=j.useState("fees"),R=mt({address:s.account.address,chain:c,tokenAddress:N(o)?void 0:o.address,client:a}),I=N(o)?q:o.address.toLowerCase(),z=N(l)?q:l.address.toLowerCase(),W=!!u&&!(c.id===i.id&&I===z),L=W?{fromAddress:s.account.address,toAddress:w,fromChainId:c.id,fromTokenAddress:N(o)?q:o.address,toChainId:i.id,toTokenAddress:N(l)?q:l.address,toAmount:u,client:a,purchaseData:y.purchaseData}:void 0,C=In(L,{staleTime:30*1e3,refetchInterval:30*1e3,gcTime:30*1e3}),E=W?(ie=C.data)==null?void 0:ie.swapDetails.fromAmount:u,U=!!E&&!!R.data&&Number(R.data.displayValue)<Number(E),_=W&&!C.data||U,p=e.payer.chain.id!==c.id;function H(G){const de="Unable to get price quote";try{if(G.error.code==="MINIMUM_PURCHASE_AMOUNT"){const le=G.error.data.minimumAmountEth;return{minAmount:K(Number(le),6)}}}catch{}return{msg:[de]}}const M=!C.isLoading&&C.error?H(C.error):void 0;function Q(){if((e.payOptions.mode==="transaction"||e.payOptions.mode==="direct_payment")&&!U&&!W){s.account.address!==w?n({id:"transfer-flow"}):e.onDone();return}C.data&&n({id:"swap-flow",quote:C.data})}function re(){C.data&&(T(!0),O("fees"))}return t.jsxs(d,{flex:"column",gap:"md",animate:"fadein",children:[F&&t.jsxs(t.Fragment,{children:[t.jsx(wt,{ref:k}),t.jsx(bt,{ref:g,close:()=>T(!1),children:f==="fees"&&C.data&&t.jsxs("div",{children:[t.jsx(x,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(h,{y:"lg"}),t.jsx(Tn,{quote:C.data,align:"left"})]})})]}),t.jsxs("div",{children:[t.jsx(St,{client:e.client,onClick:()=>{n({id:"select-wallet"})},address:e.payer.account.address,walletId:e.payer.wallet.id,containerStyle:{borderBottomRightRadius:0,borderBottomLeftRadius:0}}),t.jsx(Jn,{value:E||"",onSelectToken:r,chain:c,token:o,isLoading:C.isLoading&&!E,client:a,freezeChainAndTokenSelection:A,payerAccount:e.payer.account,swapRequired:W}),W&&t.jsx(Ct,{quoteIsLoading:C.isLoading,estimatedSeconds:(ae=C.data)==null?void 0:ae.swapDetails.estimated.durationSeconds,onViewFees:re}),t.jsx(h,{y:"md"})]}),M&&t.jsxs("div",{children:[M.minAmount&&t.jsxs(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",M.minAmount," ",t.jsx(te,{token:l,chain:i,size:"sm",inline:!0,color:"danger"})]}),(oe=M.msg)==null?void 0:oe.map(G=>t.jsx(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:G},G))]}),!M&&U&&t.jsxs("div",{children:[t.jsx(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Not enough funds."}),t.jsx(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:"Try a different wallet or token."})]}),M!=null&&M.minAmount?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(M.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):p&&!C.isLoading&&!U&&!C.error?t.jsx(ft,{variant:"accent",fullWidth:!0,switchChain:async()=>{await e.payer.wallet.switchChain(c)}}):t.jsx(P,{variant:_?"outline":"accent",fullWidth:!0,"data-disabled":_,disabled:_,onClick:async()=>{_||Q()},gap:"xs",children:C.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(fe,{size:"sm",color:"accentText"})]}):"Continue"})]})}function ls(e){var L,C,E,U,_;const{toToken:n,tokenAmount:s,payer:a,client:i,setScreen:u,toChain:l,showCurrencySelector:c,selectedCurrency:o}=e,y=((C=(L=e.payOptions)==null?void 0:L.paymentInfo)==null?void 0:C.sellerAddress)||e.payer.account.address,{drawerRef:A,drawerOverlayRef:m,isOpen:w,setIsOpen:g}=kt(),[k,F]=j.useState("fees"),T=e.payOptions.buyWithFiat,f=Fn(T!==!1&&s?{fromCurrencySymbol:o.shorthand,toChainId:l.id,toAddress:y,toTokenAddress:N(n)?q:n.address,toAmount:s,client:i,isTestMode:T==null?void 0:T.testMode,purchaseData:e.payOptions.purchaseData,fromAddress:a.account.address}:void 0);function O(){if(!f.data)return;const p=gt(f.data);let H=null;p||(H=Tt(f.data.onRampLink,typeof e.theme=="string"?e.theme:e.theme.type),ut({type:"fiat",intentId:f.data.intentId})),u({id:"fiat-flow",quote:f.data,openedWindow:H})}function R(){f.data&&(F("fees"),g(!0))}function I(p){const H="Unable to get price quote";try{if(p.error.code==="MINIMUM_PURCHASE_AMOUNT"){const Q=p.error.data.minimumAmountEth;return{minAmount:K(Number(Q),6)}}}catch{}return{msg:[H]}}const z=!f.data,W=!f.isLoading&&f.error?I(f.error):void 0;return t.jsxs(d,{flex:"column",gap:"md",animate:"fadein",children:[w&&t.jsxs(t.Fragment,{children:[t.jsx(wt,{ref:m}),t.jsx(bt,{ref:A,close:()=>g(!1),children:k==="fees"&&f.data&&t.jsxs("div",{children:[t.jsx(x,{size:"lg",color:"primaryText",children:"Fees"}),t.jsx(h,{y:"lg"}),t.jsx(An,{quote:f.data})]})})]}),t.jsxs("div",{children:[t.jsx(pn,{isLoading:f.isLoading,value:(E=f.data)==null?void 0:E.fromCurrencyWithFees.amount,client:i,currency:o,onSelectCurrency:c}),t.jsx(Ct,{quoteIsLoading:f.isLoading,estimatedSeconds:(U=f.data)==null?void 0:U.estimatedDurationSeconds,onViewFees:R}),t.jsx(h,{y:"md"})]}),W&&t.jsxs("div",{children:[W.minAmount&&t.jsxs(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:["Minimum amount is ",W.minAmount," ",t.jsx(te,{token:n,chain:l,size:"sm",inline:!0,color:"danger"})]}),(_=W.msg)==null?void 0:_.map(p=>t.jsx(x,{color:"danger",size:"sm",center:!0,multiline:!0,children:p},p))]}),W!=null&&W.minAmount?t.jsx(P,{variant:"accent",fullWidth:!0,onClick:()=>{e.setTokenAmount(String(W.minAmount)),e.setHasEditedAmount(!0)},children:"Set Minimum"}):t.jsx(P,{variant:z?"outline":"accent","data-disabled":z,disabled:z,fullWidth:!0,onClick:O,gap:"xs",children:f.isLoading?t.jsxs(t.Fragment,{children:["Getting price quote",t.jsx(fe,{size:"sm",color:"accentText"})]}):"Continue"})]})}function et(e,n,s){const a={},i=n.buyWithFiat===!1,u=n.buyWithCrypto===!1;for(const l of e)a[l.chain.id]=l.tokens.filter(c=>c.buyWithCryptoEnabled&&c.buyWithFiatEnabled?!0:!(!c.buyWithCryptoEnabled&&i||!c.buyWithFiatEnabled&&u));if(s)for(const l in s){const c=Number(l),o=s[c];o&&(a[c]=o)}return a}function tt(e){return t.jsx(Wn,{client:e.client,connectLocale:e.connectLocale,showTabs:!1,onBack:e.goBack,chains:e.chains,closeModal:e.goBack,networkSelector:{renderChain(n){return t.jsx(Bn,{chain:n.chain,confirming:!1,switchingFailed:!1,onClick:()=>{e.setChain(n.chain),e.goBack()},client:e.client,connectLocale:e.connectLocale})}}})}export{hs as default};
