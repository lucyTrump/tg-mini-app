const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-DAt5dF0_.js","assets/index-BPvgi06w.css","assets/hashMessage-CPTmk3RZ.js","assets/checkContractWalletSignature-CTY7cHHd.js","assets/isValidSignature-BLkElFpa.js","assets/checkContractWalletSignedTypedData-DS-nP1_d.js","assets/concat-hex-aYp195_m.js","assets/toRlp-DpzsLaBi.js"])))=>i.map(i=>d[i]);
import{B as ve,t as X,i as Te,f as xe,j as D,A as Pe,k as j,l as ee,m as T,n as te,o as M,q as z,r as _e,s as ne,D as ae,u as re,v as Ge,P as Oe,x as L,y as De,z as Ee,E as Ie,F as se,G as ie,H as N,J as Ue,K as H,L as P,c as Ce,M as Le,N as oe,O as b,Q as Se,R as Fe,S as E,T as ce,g as de,V as Be,W as x,X as Me,Y as Ne,Z as ue,$ as R,a0 as He,a1 as Re,a2 as $e,a3 as Ve,a4 as ke,a5 as je,a6 as U,a7 as O,a8 as W,a9 as ze,b as We,_ as w,p as pe,aa as qe,ab as Ye,d as Ze}from"./index-DAt5dF0_.js";import{concatHex as le}from"./concat-hex-aYp195_m.js";import{t as Je}from"./toRlp-DpzsLaBi.js";class Ke extends ve{constructor(e){super(`Filter type "${e}" is not supported.`,{name:"FilterTypeNotSupportedError"})}}const $=X;function ye(t){const{abi:e,args:n=[],name:r}=t,s=Te(r,{strict:!1}),a=e.filter(o=>s?o.type==="function"?xe(o)===r:o.type==="event"?$(o)===r:!1:"name"in o&&o.name===r);if(a.length===0)return;if(a.length===1)return a[0];let i;for(const o of a){if(!("inputs"in o))continue;if(!n||n.length===0){if(!o.inputs||o.inputs.length===0)return o;continue}if(!o.inputs||o.inputs.length===0||o.inputs.length!==n.length)continue;if(n.every((u,p)=>{const d="inputs"in o&&o.inputs[p];return d?S(u,d):!1})){if(i&&"inputs"in i&&i.inputs){const u=fe(o.inputs,i.inputs,n);if(u)throw new Pe({abiItem:o,type:u[0]},{abiItem:i,type:u[1]})}i=o}}return i||a[0]}function S(t,e){const n=typeof t,r=e.type;switch(r){case"address":return D(t,{strict:!1});case"bool":return n==="boolean";case"function":return n==="string";case"string":return n==="string";default:return r==="tuple"&&"components"in e?Object.values(e.components).every((s,a)=>S(Object.values(t)[a],s)):/^u?int(8|16|24|32|40|48|56|64|72|80|88|96|104|112|120|128|136|144|152|160|168|176|184|192|200|208|216|224|232|240|248|256)?$/.test(r)?n==="number"||n==="bigint":/^bytes([1-9]|1[0-9]|2[0-9]|3[0-2])?$/.test(r)?n==="string"||t instanceof Uint8Array:/[a-z]+[1-9]{0,3}(\[[0-9]{0,}\])+$/.test(r)?Array.isArray(t)&&t.every(s=>S(s,{...e,type:r.replace(/(\[[0-9]{0,}\])$/,"")})):!1}}function fe(t,e,n){for(const r in t){const s=t[r],a=e[r];if(s.type==="tuple"&&a.type==="tuple"&&"components"in s&&"components"in a)return fe(s.components,a.components,n[r]);const i=[s.type,a.type];if(i.includes("address")&&i.includes("bytes20")?!0:i.includes("address")&&i.includes("string")?D(n[r],{strict:!1}):i.includes("address")&&i.includes("bytes")?D(n[r],{strict:!1}):!1)return i}}const q="/docs/contract/encodeEventTopics";function Qe(t){var c;const{abi:e,eventName:n,args:r}=t;let s=e[0];if(n){const u=ye({abi:e,name:n});if(!u)throw new j(n,{docsPath:q});s=u}if(s.type!=="event")throw new j(void 0,{docsPath:q});const a=ee(s),i=$(a);let o=[];if(r&&"inputs"in s){const u=(c=s.inputs)==null?void 0:c.filter(d=>"indexed"in d&&d.indexed),p=Array.isArray(r)?r:Object.values(r).length>0?(u==null?void 0:u.map(d=>r[d.name]))??[]:[];p.length>0&&(o=(u==null?void 0:u.map((d,l)=>Array.isArray(p[l])?p[l].map((m,f)=>Y({param:d,value:p[l][f]})):p[l]?Y({param:d,value:p[l]}):null))??[])}return[i,...o]}function Y({param:t,value:e}){if(t.type==="string"||t.type==="bytes")return T(te(e));if(t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/))throw new Ke(t.type);return M([t],[e])}function Xe(t,e){if(!D(t,{strict:!1}))throw new z({address:t});if(!D(e,{strict:!1}))throw new z({address:e});return t.toLowerCase()===e.toLowerCase()}const Z="/docs/contract/decodeEventLog";function et(t){const{abi:e,data:n,strict:r,topics:s}=t,a=r??!0,[i,...o]=s;if(!i)throw new _e({docsPath:Z});const c=e.find(y=>y.type==="event"&&i===$(ee(y)));if(!(c&&"name"in c)||c.type!=="event")throw new ne(i,{docsPath:Z});const{name:u,inputs:p}=c,d=p==null?void 0:p.some(y=>!("name"in y&&y.name));let l=d?[]:{};const m=p.filter(y=>"indexed"in y&&y.indexed);for(let y=0;y<m.length;y++){const A=m[y],g=o[y];if(!g)throw new ae({abiItem:c,param:A});l[d?y:A.name||y]=tt({param:A,value:g})}const f=p.filter(y=>!("indexed"in y&&y.indexed));if(f.length>0){if(n&&n!=="0x")try{const y=re(f,n);if(y)if(d)l=[...l,...y];else for(let A=0;A<f.length;A++)l[f[A].name]=y[A]}catch(y){if(a)throw y instanceof Ge||y instanceof Oe?new L({abiItem:c,data:n,params:f,size:De(n)}):y}else if(a)throw new L({abiItem:c,data:"0x",params:f,size:0})}return{eventName:u,args:Object.values(l).length>0?l:void 0}}function tt({param:t,value:e}){return t.type==="string"||t.type==="bytes"||t.type==="tuple"||t.type.match(/^(.*)\[(\d+)?\]$/)?e:(re([t],e)||[])[0]}function nt(t){const{abi:e,args:n,logs:r,strict:s=!0}=t,a=(()=>{if(t.eventName)return Array.isArray(t.eventName)?t.eventName:[t.eventName]})();return r.map(i=>{var o;try{const c=ye({abi:e,name:i.topics[0]});if(!c)return null;const u=et({...i,abi:[c],strict:s});return a&&!a.includes(u.eventName)||!at({args:u.args,inputs:c.inputs,matchArgs:n})?null:{...u,...i}}catch(c){let u,p;if(c instanceof ne)return null;if(c instanceof L||c instanceof ae){if(s)return null;u=c.abiItem.name,p=(o=c.abiItem.inputs)==null?void 0:o.some(d=>!("name"in d&&d.name))}return{...i,args:p?[]:{},eventName:u}}}).filter(Boolean)}function at(t){const{args:e,inputs:n,matchArgs:r}=t;if(!r)return!0;if(!e)return!1;function s(a,i,o){try{return a.type==="address"?Xe(i,o):a.type==="string"||a.type==="bytes"?T(te(i))===o:i===o}catch{return!1}}return Array.isArray(e)&&Array.isArray(r)?r.every((a,i)=>{if(!a)return!0;const o=n[i];return o?(Array.isArray(a)?a:[a]).some(u=>s(o,u,e[i])):!1}):typeof e=="object"&&!Array.isArray(e)&&typeof r=="object"&&!Array.isArray(r)?Object.entries(r).every(([a,i])=>{if(!i)return!0;const o=n.find(u=>u.name===a);return o?(Array.isArray(i)?i:[i]).some(u=>s(o,u,e[a])):!1}):!1}function rt(t){const{domain:e={},message:n,primaryType:r}=t,s={EIP712Domain:Ee({domain:e}),...t.types};Ie({domain:e,message:n,primaryType:r,types:s});const a=["0x1901"];return e&&a.push(st({domain:e,types:s})),r!=="EIP712Domain"&&a.push(me({data:n,primaryType:r,types:s})),T(se(a))}function st({domain:t,types:e}){return me({data:t,primaryType:"EIP712Domain",types:e})}function me({data:t,primaryType:e,types:n}){const r=ge({data:t,primaryType:e,types:n});return T(r)}function ge({data:t,primaryType:e,types:n}){const r=[{type:"bytes32"}],s=[it({primaryType:e,types:n})];for(const a of n[e]){const[i,o]=Ae({types:n,name:a.name,type:a.type,value:t[a.name]});r.push(i),s.push(o)}return M(r,s)}function it({primaryType:t,types:e}){const n=ie(ot({primaryType:t,types:e}));return T(n)}function ot({primaryType:t,types:e}){let n="";const r=he({primaryType:t,types:e});r.delete(t);const s=[t,...Array.from(r).sort()];for(const a of s)n+=`${a}(${e[a].map(({name:i,type:o})=>`${o} ${i}`).join(",")})`;return n}function he({primaryType:t,types:e},n=new Set){const r=t.match(/^\w*/u),s=r==null?void 0:r[0];if(n.has(s)||e[s]===void 0)return n;n.add(s);for(const a of e[s])he({primaryType:a.type,types:e},n);return n}function Ae({types:t,name:e,type:n,value:r}){if(t[n]!==void 0)return[{type:"bytes32"},T(ge({data:r,primaryType:n,types:t}))];if(n==="bytes")return r=`0x${(r.length%2?"0":"")+r.slice(2)}`,[{type:"bytes32"},T(r)];if(n==="string")return[{type:"bytes32"},T(ie(r))];if(n.lastIndexOf("]")===n.length-1){const s=n.slice(0,n.lastIndexOf("[")),a=r.map(i=>Ae({name:e,type:s,types:t,value:i}));return[{type:"bytes32"},T(M(a.map(([i])=>i),a.map(([,i])=>i)))]}return[{type:n},r]}const ct="0xdd62ed3e",dt=[{type:"address",name:"owner"},{type:"address",name:"spender"}],ut=[{type:"uint256"}];async function pt(t){return N({contract:t.contract,method:[ct,dt,ut],params:[t.owner,t.spender]})}function I(t){if(["string","number"].includes(typeof t)&&!Number.isInteger(Number(t)))throw new Error(`Expected value to be an integer to convert to a bigint, got ${t} of type ${typeof t}`);return t instanceof Uint8Array?BigInt(Ue(t)):BigInt(t)}const be=50000n,lt=t=>{const e=yt(t);return{domain:{name:"zkSync",version:"2",chainId:t.chainId},types:{Transaction:[{name:"txType",type:"uint256"},{name:"from",type:"uint256"},{name:"to",type:"uint256"},{name:"gasLimit",type:"uint256"},{name:"gasPerPubdataByteLimit",type:"uint256"},{name:"maxFeePerGas",type:"uint256"},{name:"maxPriorityFeePerGas",type:"uint256"},{name:"paymaster",type:"uint256"},{name:"nonce",type:"uint256"},{name:"value",type:"uint256"},{name:"data",type:"bytes"},{name:"factoryDeps",type:"bytes32[]"},{name:"paymasterInput",type:"bytes"}]},primaryType:"Transaction",message:e}};function yt(t){const{gas:e,nonce:n,to:r,from:s,value:a,maxFeePerGas:i,maxPriorityFeePerGas:o,paymaster:c,paymasterInput:u,gasPerPubdata:p,data:d}=t;return{txType:113n,from:BigInt(s),to:r?BigInt(r):0n,gasLimit:e??0n,gasPerPubdataByteLimit:p??be,maxFeePerGas:i??0n,maxPriorityFeePerGas:o??0n,paymaster:c?BigInt(c):0n,nonce:n?BigInt(n):0n,value:a??0n,data:d||"0x0",factoryDeps:[],paymasterInput:u||"0x"}}async function ft(t){const{account:e,eip712Transaction:n,chainId:r}=t,s=lt(n),a=await e.signTypedData({...s});return gt({...n,chainId:r,customSignature:a})}async function mt(t){const{account:e,transaction:n}=t;let[r,s,a,i,o,c,u]=await Promise.all([H(n),P(n.to),P(n.value),P(n.gas),P(n.maxFeePerGas),P(n.maxPriorityFeePerGas),P(n.eip712).then(d=>d==null?void 0:d.gasPerPubdata)]);if(!i||!o||!c){const l=await Ce(n)({method:"zks_estimateFee",params:[{from:e.address,to:s,data:r,value:a?Le(a):void 0}]});i=I(l.gas_limit),o=I(l.max_fee_per_gas)*2n,c=I(l.max_priority_fee_per_gas)||1n,u=I(l.gas_per_pubdata_limit)}return{...await oe({transaction:{...n,gas:i,maxFeePerGas:o,maxPriorityFeePerGas:c},from:e.address}),...n.eip712,gasPerPubdata:u,from:e.address}}function gt(t){const{chainId:e,gas:n,nonce:r,to:s,from:a,value:i,maxFeePerGas:o,maxPriorityFeePerGas:c,customSignature:u,factoryDeps:p,paymaster:d,paymasterInput:l,gasPerPubdata:m,data:f}=t,y=[r?b(r):"0x",c?b(c):"0x",o?b(o):"0x",n?b(n):"0x",s??"0x",i?b(i):"0x",f??"0x0",b(e),b(""),b(""),b(e),a??"0x",m?b(m):b(be),p??[],u??"0x",d&&l?[d,l]:[]];return le(["0x71",Je(y)])}function ht(t){const{logs:e,events:n,strict:r}=t;return nt({logs:e,abi:n.map(s=>s.abiEvent),strict:r})}function At(t){return!!(t&&typeof t=="object"&&"type"in t&&t.type==="event")}function bt(t){const{signature:e}=t;let n;return At(e)?n=e:n=Se(e),{abiEvent:n,hash:X(n),topics:Qe({abi:[n],args:t.filters})}}function wt(t={}){return bt({signature:"event UserOperationRevertReason(bytes32 indexed userOpHash, address indexed sender, uint256 nonce, bytes revertReason)",filters:t})}function vt(t){const{receipt:e}=t,n={...e,transactionHash:e.transactionHash,blockNumber:e.blockNumber?BigInt(e.blockNumber):null,contractAddress:e.contractAddress?e.contractAddress:null,cumulativeGasUsed:e.cumulativeGasUsed?BigInt(e.cumulativeGasUsed):null,effectiveGasPrice:e.effectiveGasPrice?BigInt(e.effectiveGasPrice):null,gasUsed:e.gasUsed?BigInt(e.gasUsed):null,logs:e.logs,to:e.to?e.to:null,transactionIndex:e.transactionIndex,status:e.status,type:e.type};return e.blobGasPrice&&(n.blobGasPrice=BigInt(e.blobGasPrice)),e.blobGasUsed&&(n.blobGasUsed=BigInt(e.blobGasUsed)),{...t,receipt:n,userOpHash:t.userOpHash,actualGasCost:BigInt(t.actualGasCost),actualGasUsed:BigInt(t.actualGasUsed),nonce:BigInt(t.nonce)}}const Tt=()=>{const t=BigInt(Math.floor(Math.random()*4294967296)),e=BigInt(Math.floor(Math.random()*4294967296)),n=BigInt(Math.floor(Math.random()*4294967296)),r=BigInt(Math.floor(Math.random()*4294967296)),s=BigInt(Math.floor(Math.random()*4294967296)),a=BigInt(Math.floor(Math.random()*4294967296));return t<<BigInt(160)|e<<BigInt(128)|n<<BigInt(96)|r<<BigInt(64)|s<<BigInt(32)|a};function V(t){return Object.fromEntries(Object.entries(t).map(([e,n])=>[e,Fe(n)?n:b(n)]))}function xt(t){return t.id===324||t.id===300||t.id===302||t.id===11124}async function Pt(t){return G({...t,operation:"eth_sendUserOperation",params:[V(t.userOp),t.options.entrypointAddress??E]})}async function J(t){const e=await G({...t,operation:"eth_estimateUserOperationGas",params:[V(t.userOp),t.options.entrypointAddress??E]});return{preVerificationGas:x(e.preVerificationGas),verificationGas:x(e.verificationGas),verificationGasLimit:x(e.verificationGasLimit),callGasLimit:x(e.callGasLimit)+Me}}async function _t(t){const e=await G({...t,operation:"thirdweb_getUserOperationGasPrice",params:[]});return{maxPriorityFeePerGas:x(e.maxPriorityFeePerGas),maxFeePerGas:x(e.maxFeePerGas)}}async function Gt(t){var n,r;const e=await Ot(t);if(e){if(e.success===!1){const a=(r=(n=ht({events:[wt()],logs:e.logs})[0])==null?void 0:n.args)==null?void 0:r.revertReason;if(!a)throw new Error(`UserOp failed at txHash: ${e.receipt.transactionHash}`);const i=Ne({data:a});throw new Error(`UserOp failed with reason: '${i.args.join(",")}' at txHash: ${e.receipt.transactionHash}`)}return e.receipt}}async function Ot(t){const e=await G({options:t,operation:"eth_getUserOperationReceipt",params:[t.userOpHash]});if(e)return vt(e)}async function Dt(t){const e=await G({options:t.options,operation:"zk_paymasterData",params:[t.transaction]});return{paymaster:e.paymaster,paymasterInput:e.paymasterInput}}async function Et(t){return{transactionHash:(await G({options:t.options,operation:"zk_broadcastTransaction",params:[{...t.transaction,signedTransaction:t.signedTransaction}]})).transactionHash}}async function G(t){const{options:e,operation:n,params:r}=t,s=e.bundlerUrl??ce(e.chain),i=await de(e.client)(s,{method:"POST",headers:{"Content-Type":"application/json"},body:Be({jsonrpc:"2.0",id:1,method:n,params:r})}),o=await i.json();if(!i.ok||o.error){let c=o.error||i.statusText;typeof c=="object"&&(c=JSON.stringify(c));const u=o.code||"UNKNOWN";throw new Error(`${n} error: ${c}
Status: ${i.status}
Code: ${u}`)}return o.result}async function It(t){const{factoryContract:e,predictAddressOverride:n,adminAddress:r,accountSalt:s,accountAddress:a}=t;if(n)return n(e);if(a)return a;if(!r)throw new Error("Account address is required to predict the smart wallet address.");const i=ue(s??"");return N({contract:e,method:"function getAddress(address, bytes) returns (address)",params:[r,i]})}function Ut(t){const{adminAddress:e,factoryContract:n,createAccountOverride:r,accountSalt:s}=t;return r?r(n):R({contract:n,method:"function createAccount(address, bytes) returns (address)",params:[e,ue(s??"")]})}function we(t){const{accountContract:e,transaction:n,executeOverride:r}=t;return r?r(e,n):R({contract:e,method:"function execute(address, uint256, bytes)",params:[n.to||"",n.value||0n,n.data||"0x"]})}function Ct(t){const{accountContract:e,transactions:n,executeBatchOverride:r}=t;return r?r(e,n):R({contract:e,method:"function executeBatch(address[], uint256[], bytes[])",params:[n.map(s=>s.to||""),n.map(s=>s.value||0n),n.map(s=>s.data||"0x")]})}const Lt="0x35567e1a",St=[{type:"address",name:"sender"},{type:"uint192",name:"key"}],Ft=[{type:"uint256",name:"nonce"}];async function Bt(t){return N({contract:t.contract,method:[Lt,St,Ft],params:[t.sender,t.key]})}async function K(t){var m;const{userOp:e,paymasterOverride:n,client:r,chain:s,entrypointAddress:a}=t;if(n)return n(e);const i={"Content-Type":"application/json"},o=He(s),c=a??E,p=await de(r)(o,{method:"POST",headers:i,body:JSON.stringify({jsonrpc:"2.0",id:1,method:"pm_sponsorUserOperation",params:[V(e),c]})}),d=await p.json();if(!p.ok){const f=d.error||p.statusText,y=d.code||"UNKNOWN";throw new Error(`Paymaster error: ${f}
Status: ${p.status}
Code: ${y}`)}if(d.result)return typeof d.result=="string"?{paymasterAndData:d.result}:{paymasterAndData:d.result.paymasterAndData,verificationGasLimit:d.result.verificationGasLimit?x(d.result.verificationGasLimit):void 0,preVerificationGas:d.result.preVerificationGas?x(d.result.preVerificationGas):void 0,callGasLimit:d.result.callGasLimit?x(d.result.callGasLimit):void 0};const l=((m=d.error)==null?void 0:m.message)||d.error||p.statusText||"unknown error";throw new Error(`Paymaster error from ${o}: ${l}`)}async function Mt(t){const e=t.timeoutMs||12e4,n=t.intervalMs||1e3,r=Date.now()+e;for(;Date.now()<r;){const s=await Gt(t);if(s)return s;await new Promise(a=>setTimeout(a,n))}throw new Error("Timeout waiting for userOp to be mined")}async function Nt(t){const{transaction:e,accountContract:n,factoryContract:r,adminAddress:s,overrides:a,sponsorGas:i}=t,o=e.chain,c=e.client,p=await Re(n)?"0x":await Rt({factoryContract:r,adminAddress:s,accountSalt:a==null?void 0:a.accountSalt,createAccountOverride:a==null?void 0:a.createAccount}),d=await H(e),l={client:c,chain:o,entrypointAddress:a==null?void 0:a.entrypointAddress};let{maxFeePerGas:m,maxPriorityFeePerGas:f}=e;const y=(a==null?void 0:a.bundlerUrl)??ce(o);if($e(y)){const h=await _t({options:l});m=h.maxFeePerGas,f=h.maxPriorityFeePerGas}else{const[h,v]=await Promise.all([P(m),P(f)]);if(h&&v)m=h,f=v;else{const _=await Ve(c,o);f=v??_.maxPriorityFeePerGas??0n,m=h??_.maxFeePerGas??0n}}const A=await $t({accountContract:n,chain:o,client:c,entrypointAddress:a==null?void 0:a.entrypointAddress,getNonceOverride:a==null?void 0:a.getAccountNonce}),g={sender:n.address,nonce:A,initCode:p,callData:d,maxFeePerGas:m,maxPriorityFeePerGas:f,callGasLimit:0n,verificationGasLimit:0n,preVerificationGas:0n,paymasterAndData:"0x",signature:ke};if(i){const h=await K({userOp:g,chain:o,client:c,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster}),v=h.paymasterAndData;if(v&&v!=="0x"&&(g.paymasterAndData=v),h.callGasLimit&&h.verificationGasLimit&&h.preVerificationGas)g.callGasLimit=h.callGasLimit,g.verificationGasLimit=h.verificationGasLimit,g.preVerificationGas=h.preVerificationGas;else{const _=await J({userOp:g,options:l});if(g.callGasLimit=_.callGasLimit,g.verificationGasLimit=_.verificationGasLimit,g.preVerificationGas=_.preVerificationGas,v&&v!=="0x"){const C=await K({userOp:g,chain:o,client:c,entrypointAddress:a==null?void 0:a.entrypointAddress,paymasterOverride:a==null?void 0:a.paymaster});C.paymasterAndData&&C.paymasterAndData!=="0x"&&(g.paymasterAndData=C.paymasterAndData)}}}else{const h=await J({userOp:g,options:l});g.callGasLimit=h.callGasLimit,g.verificationGasLimit=h.verificationGasLimit,g.preVerificationGas=h.preVerificationGas}return{...g,signature:"0x"}}async function Ht(t){const{userOp:e,chain:n,entrypointAddress:r,adminAccount:s}=t,a=Vt({userOp:e,entryPoint:r||E,chainId:n.id});if(s.signMessage){const i=await s.signMessage({message:{raw:je(a)}});return{...e,signature:i}}throw new Error("signMessage not implemented in signingAccount")}async function Rt(t){const{factoryContract:e,adminAddress:n,accountSalt:r,createAccountOverride:s}=t,a=Ut({factoryContract:e,adminAddress:n,accountSalt:r,createAccountOverride:s});return se([e.address,await H(a)])}async function $t(t){const{accountContract:e,chain:n,client:r,entrypointAddress:s,getNonceOverride:a}=t;return a?a(e):Bt({contract:U({address:s||E,chain:n,client:r}),key:Tt(),sender:e.address})}function Vt(t){const{userOp:e,entryPoint:n,chainId:r}=t,s=O(e.initCode),a=O(e.callData),i=O(e.paymasterAndData),o=W([{type:"address"},{type:"uint256"},{type:"bytes32"},{type:"bytes32"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"uint256"},{type:"bytes32"}],[e.sender,e.nonce,s,a,e.callGasLimit,e.verificationGasLimit,e.preVerificationGas,e.maxFeePerGas,e.maxPriorityFeePerGas,i]),c=W([{type:"bytes32"},{type:"address"},{type:"uint256"}],[O(o),n,BigInt(r)]);return O(c)}function kt(t){return t.id==="smart"}const k=new WeakMap,F=new WeakMap;async function jt(t,e,n){var f,y,A;const{personalAccount:r,client:s,chain:a}=e;if(!r)throw new Error("Personal wallet does not have an account");const i=n,o=i.factoryAddress??ze,c=a??i.chain,u="gasless"in i?i.gasless:i.sponsorGas;if(xt(c))return[Yt({creationOptions:n,connectionOptions:e,chain:c,sponsorGas:u}),c];const p=U({client:s,address:o,chain:c}),d=await It({factoryContract:p,adminAddress:r.address,predictAddressOverride:(f=i.overrides)==null?void 0:f.predictAddress,accountSalt:(y=i.overrides)==null?void 0:y.accountSalt,accountAddress:(A=i.overrides)==null?void 0:A.accountAddress}).then(g=>g).catch(g=>{throw new Error(`Failed to get account address with factory contract ${p.address} on chain ID ${c.id}. Are you on the right chain?`,{cause:g})}),l=U({client:s,address:d,chain:c}),m=await Wt({...i,chain:c,sponsorGas:u,personalAccount:r,accountContract:l,factoryContract:p,client:s});return k.set(r,t),F.set(t,r),[m,c]}async function zt(t){const e=F.get(t);e&&(k.delete(e),F.delete(t))}async function Wt(t){const{accountContract:e}=t,n={address:We(e.address),async sendTransaction(r){var o,c,u;const s=(o=t.overrides)==null?void 0:o.erc20Paymaster;let a;if(s){await qt({accountContract:e,erc20Paymaster:s,options:t});const p=async()=>({paymasterAndData:le([s.address,s==null?void 0:s.token])});a=((c=t.overrides)==null?void 0:c.paymaster)||p}const i=we({accountContract:e,transaction:r,executeOverride:(u=t.overrides)==null?void 0:u.execute});return B({executeTx:i,options:{...t,overrides:{...t.overrides,paymaster:a}}})},async sendBatchTransaction(r){var a;const s=Ct({accountContract:e,transactions:r,executeBatchOverride:(a=t.overrides)==null?void 0:a.executeBatch});return B({executeTx:s,options:t})},async signMessage({message:r}){const[{isContractDeployed:s},{readContract:a},{encodeAbiParameters:i},{hashMessage:o},{checkContractWalletSignature:c}]=await Promise.all([w(()=>import("./index-DAt5dF0_.js").then(f=>f.d_),__vite__mapDeps([0,1])),w(()=>import("./index-DAt5dF0_.js").then(f=>f.e0),__vite__mapDeps([0,1])),w(()=>import("./index-DAt5dF0_.js").then(f=>f.d$),__vite__mapDeps([0,1])),w(()=>import("./hashMessage-CPTmk3RZ.js"),__vite__mapDeps([2,0,1])),w(()=>import("./checkContractWalletSignature-CTY7cHHd.js"),__vite__mapDeps([3,4,0,1]))]);await s(e)||await Q({options:t,account:n,accountContract:e});const p=o(r);let d=!1;try{await a({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[p]}),d=!0}catch{}let l;if(d){const f=i([{type:"bytes32"}],[p]);l=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:f}})}else l=await t.personalAccount.signMessage({message:r});if(await c({contract:e,message:r,signature:l}))return l;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async signTypedData(r){var y,A,g;const s=pe(r),[{isContractDeployed:a},{readContract:i},{encodeAbiParameters:o},{checkContractWalletSignedTypedData:c}]=await Promise.all([w(()=>import("./index-DAt5dF0_.js").then(h=>h.d_),__vite__mapDeps([0,1])),w(()=>import("./index-DAt5dF0_.js").then(h=>h.e0),__vite__mapDeps([0,1])),w(()=>import("./index-DAt5dF0_.js").then(h=>h.d$),__vite__mapDeps([0,1])),w(()=>import("./checkContractWalletSignedTypedData-DS-nP1_d.js"),__vite__mapDeps([5,4,0,1,6,7]))]);if(((A=(y=s.domain)==null?void 0:y.verifyingContract)==null?void 0:A.toLowerCase())===((g=e.address)==null?void 0:g.toLowerCase()))return t.personalAccount.signTypedData(s);await a(e)||await Q({options:t,account:n,accountContract:e});const d=rt(s);let l=!1;try{await i({contract:e,method:"function getMessageHash(bytes32 _hash) public view returns (bytes32)",params:[d]}),l=!0}catch{}let m;if(l){const h=o([{type:"bytes32"}],[d]);m=await t.personalAccount.signTypedData({domain:{name:"Account",version:"1",chainId:t.chain.id,verifyingContract:e.address},primaryType:"AccountMessage",types:{AccountMessage:[{name:"message",type:"bytes"}]},message:{message:h}})}else m=await t.personalAccount.signTypedData(s);if(await c({contract:e,data:s,signature:m}))return m;throw new Error("Unable to verify signature on smart account, please make sure the smart account is deployed and the signature is valid.")},async onTransactionRequested(r){var s,a;return(a=(s=t.personalAccount).onTransactionRequested)==null?void 0:a.call(s,r)}};return n}async function qt(t){var p;const{accountContract:e,erc20Paymaster:n,options:r}=t,s=n.token,a=U({address:s,chain:e.chain,client:e.client});if(await pt({contract:a,owner:e.address,spender:n.address})>0n)return;const o=qe({contract:a,spender:n.address,amountWei:Ye-1n}),c=await oe({transaction:o,from:e.address}),u=we({accountContract:e,transaction:c,executeOverride:(p=r.overrides)==null?void 0:p.execute});await B({executeTx:u,options:{...r,overrides:{...r.overrides,erc20Paymaster:void 0}}})}function Yt(t){const{creationOptions:e,connectionOptions:n,chain:r}=t,s={address:n.personalAccount.address,async sendTransaction(a){var p,d,l,m;const i={data:a.data,to:a.to??void 0,value:a.value??0n,chain:Ze(a.chainId),client:n.client};let o=await mt({account:s,transaction:i});if(t.sponsorGas){const f=await Dt({options:{client:n.client,chain:r,bundlerUrl:(p=e.overrides)==null?void 0:p.bundlerUrl,entrypointAddress:(d=e.overrides)==null?void 0:d.entrypointAddress},transaction:o});o={...o,...f}}const c=await ft({account:s,chainId:r.id,eip712Transaction:o});return{transactionHash:(await Et({options:{client:n.client,chain:r,bundlerUrl:(l=e.overrides)==null?void 0:l.bundlerUrl,entrypointAddress:(m=e.overrides)==null?void 0:m.entrypointAddress},transaction:o,signedTransaction:c})).transactionHash,client:n.client,chain:r}},async signMessage({message:a}){return n.personalAccount.signMessage({message:a})},async signTypedData(a){const i=pe(a);return n.personalAccount.signTypedData(i)},async onTransactionRequested(a){var i,o;return(o=(i=n.personalAccount).onTransactionRequested)==null?void 0:o.call(i,a)}};return s}async function Q(t){const{options:e,account:n,accountContract:r}=t,[{sendTransaction:s},{prepareTransaction:a}]=await Promise.all([w(()=>import("./index-DAt5dF0_.js").then(c=>c.e3),__vite__mapDeps([0,1])),w(()=>import("./index-DAt5dF0_.js").then(c=>c.e1),__vite__mapDeps([0,1]))]),i=a({client:e.client,chain:e.chain,to:r.address,value:0n,gas:50000n});return await s({transaction:i,account:n})}async function B(t){var o;const{executeTx:e,options:n}=t,r=await Nt({transaction:e,factoryContract:n.factoryContract,accountContract:n.accountContract,adminAddress:n.personalAccount.address,sponsorGas:n.sponsorGas,overrides:n.overrides}),s=await Ht({chain:n.chain,adminAccount:n.personalAccount,entrypointAddress:(o=n.overrides)==null?void 0:o.entrypointAddress,userOp:r}),a=await Pt({options:n,userOp:s}),i=await Mt({...n,userOpHash:a});return{client:n.client,chain:n.chain,transactionHash:i.transactionHash}}const Qt=Object.freeze(Object.defineProperty({__proto__:null,connectSmartWallet:jt,disconnectSmartWallet:zt,isSmartWallet:kt,personalAccountToSmartAccountMap:k},Symbol.toStringTag,{value:"Module"}));export{rt as h,Qt as i};
