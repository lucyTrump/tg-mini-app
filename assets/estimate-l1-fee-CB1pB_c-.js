import{B as l,cO as E,cN as P,da as Y,i as J,n as Q,y as O,cM as X,j as w,q as z,db as Z,dc as ee,G as a,ad as I,dd as k,a6 as te,N as se,H as ne}from"./index-DAt5dF0_.js";import{t as y}from"./toRlp-DpzsLaBi.js";const oe={ether:-9,wei:9};function ie(e,t){let s=e.toString();const n=s.startsWith("-");n&&(s=s.slice(1)),s=s.padStart(t,"0");let[o,i]=[s.slice(0,s.length-t),s.slice(s.length-t)];return i=i.replace(/(0+)$/,""),`${n?"-":""}${o||"0"}${i?`.${i}`:""}`}function L(e,t="wei"){return ie(e,oe[t])}function re(e){const t=Object.entries(e).map(([n,o])=>o===void 0||o===!1?null:[n,o]).filter(Boolean),s=t.reduce((n,[o])=>Math.max(n,o.length),0);return t.map(([n,o])=>`  ${`${n}:`.padEnd(s+1)}  ${o}`).join(`
`)}class ae extends l{constructor({transaction:t}){super("Cannot infer a transaction type from provided transaction.",{metaMessages:["Provided Transaction:","{",re(t),"}","","To infer the type, either provide:","- a `type` to the Transaction, or","- an EIP-1559 Transaction with `maxFeePerGas`, or","- an EIP-2930 Transaction with `gasPrice` & `accessList`, or","- an EIP-4844 Transaction with `blobs`, `blobVersionedHashes`, `sidecars`, or","- an EIP-7702 Transaction with `authorizationList`, or","- a Legacy Transaction with `gasPrice`"],name:"InvalidSerializableTransactionError"})}}class ce extends l{constructor({storageKey:t}){super(`Size for storage key "${t}" is invalid. Expected 32 bytes. Got ${Math.floor((t.length-2)/2)} bytes.`,{name:"InvalidStorageKeySizeError"})}}class F extends l{constructor({cause:t,maxFeePerGas:s}={}){super(`The fee cap (\`maxFeePerGas\`${s?` = ${L(s)} gwei`:""}) cannot be higher than the maximum allowed value (2^256-1).`,{cause:t,name:"FeeCapTooHighError"})}}Object.defineProperty(F,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max fee per gas higher than 2\^256-1|fee cap higher than 2\^256-1/});class K extends l{constructor({cause:t,maxPriorityFeePerGas:s,maxFeePerGas:n}={}){super([`The provided tip (\`maxPriorityFeePerGas\`${s?` = ${L(s)} gwei`:""}) cannot be higher than the fee cap (\`maxFeePerGas\`${n?` = ${L(n)} gwei`:""}).`].join(`
`),{cause:t,name:"TipAboveFeeCapError"})}}Object.defineProperty(K,"nodeMessage",{enumerable:!0,configurable:!0,writable:!0,value:/max priority fee per gas higher than max fee per gas|tip higher than fee cap/});function _(e){const{kzg:t}=e,s=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),n=typeof e.blobs[0]=="string"?e.blobs.map(i=>E(i)):e.blobs,o=[];for(const i of n)o.push(Uint8Array.from(t.blobToKzgCommitment(i)));return s==="bytes"?o:o.map(i=>P(i))}function U(e){const{kzg:t}=e,s=e.to??(typeof e.blobs[0]=="string"?"hex":"bytes"),n=typeof e.blobs[0]=="string"?e.blobs.map(r=>E(r)):e.blobs,o=typeof e.commitments[0]=="string"?e.commitments.map(r=>E(r)):e.commitments,i=[];for(let r=0;r<n.length;r++){const c=n[r],f=o[r];i.push(Uint8Array.from(t.computeBlobKzgProof(c,f)))}return s==="bytes"?i:i.map(r=>P(r))}function fe(e,t){return Y(J(e,{strict:!1})?Q(e):e)}function de(e){const{commitment:t,version:s=1}=e,n=e.to??(typeof t=="string"?"hex":"bytes"),o=fe(t);return o.set([s],0),n==="bytes"?o:P(o)}function le(e){const{commitments:t,version:s}=e,n=e.to??(typeof t[0]=="string"?"hex":"bytes"),o=[];for(const i of t)o.push(de({commitment:i,to:n,version:s}));return o}const M=6,N=32,B=4096,R=N*B,j=R*M-1-1*B*M,D=1;class ue extends l{constructor({maxSize:t,size:s}){super("Blob size is too large.",{metaMessages:[`Max: ${t} bytes`,`Given: ${s} bytes`],name:"BlobSizeTooLargeError"})}}class q extends l{constructor(){super("Blob data must not be empty.",{name:"EmptyBlobError"})}}class he extends l{constructor({hash:t,size:s}){super(`Versioned hash "${t}" size is invalid.`,{metaMessages:["Expected: 32",`Received: ${s}`],name:"InvalidVersionedHashSizeError"})}}class be extends l{constructor({hash:t,version:s}){super(`Versioned hash "${t}" version is invalid.`,{metaMessages:[`Expected: ${D}`,`Received: ${s}`],name:"InvalidVersionedHashVersionError"})}}function me(e){const t=e.to??(typeof e.data=="string"?"hex":"bytes"),s=typeof e.data=="string"?E(e.data):e.data,n=O(s);if(!n)throw new q;if(n>j)throw new ue({maxSize:j,size:n});const o=[];let i=!0,r=0;for(;i;){const c=X(new Uint8Array(R));let f=0;for(;f<B;){const d=s.slice(r,r+(N-1));if(c.pushByte(0),c.pushBytes(d),d.length<31){c.pushByte(128),i=!1;break}f++,r+=31}o.push(c)}return t==="bytes"?o.map(c=>c.bytes):o.map(c=>P(c.bytes))}function xe(e){const{data:t,kzg:s,to:n}=e,o=e.blobs??me({data:t,to:n}),i=e.commitments??_({blobs:o,kzg:s,to:n}),r=e.proofs??U({blobs:o,commitments:i,kzg:s,to:n}),c=[];for(let f=0;f<o.length;f++)c.push({blob:o[f],commitment:i[f],proof:r[f]});return c}function ye(e){if(e.type)return e.type;if(typeof e.authorizationList<"u")return"eip7702";if(typeof e.blobs<"u"||typeof e.blobVersionedHashes<"u"||typeof e.maxFeePerBlobGas<"u"||typeof e.sidecars<"u")return"eip4844";if(typeof e.maxFeePerGas<"u"||typeof e.maxPriorityFeePerGas<"u")return"eip1559";if(typeof e.gasPrice<"u")return typeof e.accessList<"u"?"eip2930":"legacy";throw new ae({transaction:e})}class G extends l{constructor({chainId:t}){super(typeof t=="number"?`Chain ID "${t}" is invalid.`:"Chain ID is invalid.",{name:"InvalidChainIdError"})}}function pe(e){const{authorizationList:t}=e;if(t)for(const s of t){const{contractAddress:n,chainId:o}=s;if(!w(n))throw new z({address:n});if(o<=0)throw new G({chainId:o})}A(e)}function ge(e){const{blobVersionedHashes:t}=e;if(t){if(t.length===0)throw new q;for(const s of t){const n=O(s),o=Z(ee(s,0,1));if(n!==32)throw new he({hash:s,size:n});if(o!==D)throw new be({hash:s,version:o})}}A(e)}function A(e){const{chainId:t,maxPriorityFeePerGas:s,maxFeePerGas:n,to:o}=e;if(t<=0)throw new G({chainId:t});if(o&&!w(o))throw new z({address:o});if(n&&n>2n**256n-1n)throw new F({maxFeePerGas:n});if(s&&n&&s>n)throw new K({maxFeePerGas:n,maxPriorityFeePerGas:s})}function Pe(e){const{chainId:t,maxPriorityFeePerGas:s,gasPrice:n,maxFeePerGas:o,to:i}=e;if(t<=0)throw new G({chainId:t});if(i&&!w(i))throw new z({address:i});if(s||o)throw new l("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid EIP-2930 Transaction attribute.");if(n&&n>2n**256n-1n)throw new F({maxFeePerGas:n})}function we(e){const{chainId:t,maxPriorityFeePerGas:s,gasPrice:n,maxFeePerGas:o,to:i}=e;if(i&&!w(i))throw new z({address:i});if(typeof t<"u"&&t<=0)throw new G({chainId:t});if(s||o)throw new l("`maxFeePerGas`/`maxPriorityFeePerGas` is not a valid Legacy Transaction attribute.");if(n&&n>2n**256n-1n)throw new F({maxFeePerGas:n})}function ze(e){if(!e||e.length===0)return[];const t=[];for(const s of e){const{contractAddress:n,chainId:o,nonce:i,...r}=s;t.push([a(o),n,[i?a(i):"0x"],...T({},r)])}return t}function $(e){if(!e||e.length===0)return[];const t=[];for(let s=0;s<e.length;s++){const{address:n,storageKeys:o}=e[s];for(let i=0;i<o.length;i++)if(o[i].length-2!==64)throw new ce({storageKey:o[i]});if(!w(n,{strict:!1}))throw new z({address:n});t.push([n,o])}return t}function Te(e,t){const s=ye(e);return s==="eip1559"?Ie(e,t):s==="eip2930"?Fe(e,t):s==="eip4844"?Ee(e,t):s==="eip7702"?ve(e,t):Ge(e)}function ve(e,t){const{authorizationList:s,chainId:n,gas:o,nonce:i,to:r,value:c,maxFeePerGas:f,maxPriorityFeePerGas:d,accessList:b,data:m}=e;pe(e);const h=$(b),u=ze(s);return I(["0x04",y([a(n),i?a(i):"0x",d?a(d):"0x",f?a(f):"0x",o?a(o):"0x",r??"0x",c?a(c):"0x",m??"0x",h,u,...T(e,t)])])}function Ee(e,t){const{chainId:s,gas:n,nonce:o,to:i,value:r,maxFeePerBlobGas:c,maxFeePerGas:f,maxPriorityFeePerGas:d,accessList:b,data:m}=e;ge(e);let h=e.blobVersionedHashes,u=e.sidecars;if(e.blobs&&(typeof h>"u"||typeof u>"u")){const x=typeof e.blobs[0]=="string"?e.blobs:e.blobs.map(g=>P(g)),v=e.kzg,p=_({blobs:x,kzg:v});if(typeof h>"u"&&(h=le({commitments:p})),typeof u>"u"){const g=U({blobs:x,commitments:p,kzg:v});u=xe({blobs:x,commitments:p,proofs:g})}}const W=$(b),H=[a(s),o?a(o):"0x",d?a(d):"0x",f?a(f):"0x",n?a(n):"0x",i??"0x",r?a(r):"0x",m??"0x",W,c?a(c):"0x",h??[],...T(e,t)],S=[],V=[],C=[];if(u)for(let x=0;x<u.length;x++){const{blob:v,commitment:p,proof:g}=u[x];S.push(v),V.push(p),C.push(g)}return I(["0x03",u?y([H,S,V,C]):y(H)])}function Ie(e,t){const{chainId:s,gas:n,nonce:o,to:i,value:r,maxFeePerGas:c,maxPriorityFeePerGas:f,accessList:d,data:b}=e;A(e);const m=$(d),h=[a(s),o?a(o):"0x",f?a(f):"0x",c?a(c):"0x",n?a(n):"0x",i??"0x",r?a(r):"0x",b??"0x",m,...T(e,t)];return I(["0x02",y(h)])}function Fe(e,t){const{chainId:s,gas:n,data:o,nonce:i,to:r,value:c,accessList:f,gasPrice:d}=e;Pe(e);const b=$(f),m=[a(s),i?a(i):"0x",d?a(d):"0x",n?a(n):"0x",r??"0x",c?a(c):"0x",o??"0x",b,...T(e,t)];return I(["0x01",y(m)])}function Ge(e,t){const{chainId:s=0,gas:n,data:o,nonce:i,to:r,value:c,gasPrice:f}=e;we(e);let d=[i?a(i):"0x",f?a(f):"0x",n?a(n):"0x",r??"0x",c?a(c):"0x",o??"0x"];return s>0&&(d=[...d,a(s),"0x","0x"]),y(d)}function T(e,t){const s=t??e,{v:n,yParity:o}=s;if(typeof s.r>"u")return[];if(typeof s.s>"u")return[];if(typeof n>"u"&&typeof o>"u")return[];const i=k(s.r),r=k(s.s);return[typeof o=="number"?o?a(1):"0x":n===0n?"0x":n===1n?a(1):n===27n?"0x":a(1),i==="0x00"?"0x":i,r==="0x00"?"0x":r]}const $e="0x420000000000000000000000000000000000000F";async function Ae(e){const{transaction:t,gasPriceOracleAddress:s}=e,n=te({client:t.client,address:s||$e,chain:t.chain}),{gasPrice:o,...i}=await se({transaction:t}),r=Te({...i,type:"eip1559"});return ne({contract:n,method:"function getL1Fee(bytes memory _data) view returns (uint256)",params:[r]})}export{Ae as estimateL1Fee};
