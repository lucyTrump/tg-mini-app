const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index.es-BY6-n0QV.js","assets/index-DAt5dF0_.js","assets/index-BPvgi06w.css"])))=>i.map(i=>d[i]);
import{B as L,aE as z,aF as Q,az as R,d as C,aG as j,_ as B,aH as K,aI as v,aA as O,M,aB as $,aJ as A,aK as G,b as x,aL as H,aM as Y,Z,J as X,p as ee,z as ae,E as ne,aD as te}from"./index-DAt5dF0_.js";const se=a=>a;class ie extends L{constructor({body:n,error:t,url:c}){super("RPC Request failed.",{cause:t,details:t.message,metaMessages:[`URL: ${se(c)}`,`Request body: ${z(n)}`],name:"RpcRequestError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.code=t.code}}const ce=-1;class re extends L{constructor(n,{code:t,docsPath:c,metaMessages:s,name:e,shortMessage:i}){super(i,{cause:n,docsPath:c,metaMessages:s||(n==null?void 0:n.metaMessages),name:e||"RpcError"}),Object.defineProperty(this,"code",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e||n.name,this.code=n instanceof ie?n.code:t??ce}}class k extends re{constructor(n,t){super(n,t),Object.defineProperty(this,"data",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.data=t.data}}class P extends k{constructor(n){super(n,{code:P.code,name:"UserRejectedRequestError",shortMessage:"User rejected the request."})}}Object.defineProperty(P,"code",{enumerable:!0,configurable:!0,writable:!0,value:4001});class _ extends k{constructor(n){super(n,{code:_.code,name:"SwitchChainError",shortMessage:"An error occurred when attempting to switch chain."})}}Object.defineProperty(_,"code",{enumerable:!0,configurable:!0,writable:!0,value:4902});const N="wallet_addEthereumChain",oe=!0,q={requestedChains:"tw.wc.requestedChains",lastUsedChainId:"tw.wc.lastUsedChainId"};async function me(a,n,t,c,s){var T,y;const e=await F(a,t,s),i=a.walletConnect;let{onDisplayUri:d}=i||{};if(!d&&s&&t!=="walletConnect"){const f=await j(t);d=p=>{const w=f.mobile.native||f.mobile.universal;if(!w)throw new Error("No app url found for wallet connect to redirect to.");const I=Y(w,p).redirect;s(I)}}d&&e.events.addListener("display_uri",d);let l=i==null?void 0:i.optionalChains,r=a.chain;t==="global.safe"&&(l=W.map(C),r&&!l.includes(r)&&(r=void 0));const{rpcMap:o,chainsToRequest:u}=V({client:a.client,chain:r,optionalChains:l});e.session&&await e.connect({...i!=null&&i.pairingTopic?{pairingTopic:i==null?void 0:i.pairingTopic}:{},optionalChains:u,chains:r?[r.id]:u.length>0?[u[0]]:[1],rpcMap:o}),U(u,c);const h=(await e.enable())[0];if(!h)throw new Error("No accounts found on provider.");const g=R(e.chainId),b=a.chain&&a.chain.id===g?a.chain:C(g);if(a){const f={optionalChains:(T=a.walletConnect)==null?void 0:T.optionalChains,chain:a.chain,pairingTopic:(y=a.walletConnect)==null?void 0:y.pairingTopic};c&&G(c,t,f)}return i!=null&&i.onDisplayUri&&e.events.removeListener("display_uri",i.onDisplayUri),J(h,b,e,n,c)}async function pe(a,n,t,c,s){const e=c?await Q(c,t):null,i=await F(e?{chain:e.chain,client:a.client,walletConnect:{pairingTopic:e.pairingTopic,optionalChains:e.optionalChains}}:{client:a.client,walletConnect:{}},t,s,!0),d=i.accounts[0];if(!d)throw new Error("No accounts found on provider.");const l=R(i.chainId),r=a.chain&&a.chain.id===l?a.chain:C(l);return J(d,r,i,n,c)}async function F(a,n,t,c=!1){var g,b,T,y;const s=await j(n),e=a.walletConnect,{EthereumProvider:i,OPTIONAL_EVENTS:d,OPTIONAL_METHODS:l}=await B(async()=>{const{EthereumProvider:f,OPTIONAL_EVENTS:E,OPTIONAL_METHODS:p}=await import("./index.es-BY6-n0QV.js");return{EthereumProvider:f,OPTIONAL_EVENTS:E,OPTIONAL_METHODS:p}},__vite__mapDeps([0,1,2]));let r=e==null?void 0:e.optionalChains,o=a.chain;n==="global.safe"&&(r=W.map(C),o&&!r.includes(o)&&(o=void 0));const{rpcMap:u,chainsToRequest:m}=V({client:a.client,chain:o,optionalChains:r}),h=await i.init({showQrModal:(e==null?void 0:e.showQrModal)===void 0?t?!1:oe:e.showQrModal,projectId:(e==null?void 0:e.projectId)||K,optionalMethods:l,optionalEvents:d,optionalChains:m,chains:o?[o.id]:m.length>0?[m[0]]:[1],metadata:{name:((g=e==null?void 0:e.appMetadata)==null?void 0:g.name)||v().name,description:((b=e==null?void 0:e.appMetadata)==null?void 0:b.description)||v().description,url:((T=e==null?void 0:e.appMetadata)==null?void 0:T.url)||v().url,icons:[((y=e==null?void 0:e.appMetadata)==null?void 0:y.logoUrl)||v().logoUrl]},rpcMap:u,qrModalOptions:e==null?void 0:e.qrModalOptions,disableProviderPing:!0});if(h.events.setMaxListeners(Number.POSITIVE_INFINITY),c||h.session&&await h.disconnect(),n!=="walletConnect"){let f=function(){var p,w,I,D;const E=((D=(I=(w=(p=h.session)==null?void 0:p.peer)==null?void 0:w.metadata)==null?void 0:I.redirect)==null?void 0:D.native)||s.mobile.native||s.mobile.universal;t&&E&&t(E)};h.signer.client.on("session_request_sent",f),h.events.addListener("disconnect",()=>{h.signer.client.off("session_request_sent",f)})}return h}function S(a,n){return{address:x(n),async sendTransaction(s){return{transactionHash:await a.request({method:"eth_sendTransaction",params:[{gas:s.gas?M(s.gas):void 0,value:s.value?M(s.value):void 0,from:this.address,to:s.to,data:s.data}]})}},async signMessage({message:s}){const e=typeof s=="string"?Z(s):s.raw instanceof Uint8Array?X(s.raw):s.raw;return a.request({method:"personal_sign",params:[e,this.address]})},async signTypedData(s){const e=ee(s),{domain:i,message:d,primaryType:l}=e,r={EIP712Domain:ae({domain:i}),...e.types};ne({domain:i,message:d,primaryType:l,types:r});const o=te({domain:i??{},message:d,primaryType:l,types:r});return await a.request({method:"eth_signTypedData_v4",params:[this.address,o]})}}}function J(a,n,t,c,s){const e=S(t,a);async function i(){t.removeListener("accountsChanged",l),t.removeListener("chainChanged",r),t.removeListener("disconnect",d),await t.disconnect()}function d(){U([],s),s==null||s.removeItem(q.lastUsedChainId),i(),c.emit("disconnect",void 0)}function l(o){if(o[0]){const u=S(t,x(o[0]));c.emit("accountChanged",u),c.emit("accountsChanged",o)}else d()}function r(o){const u=C(R(o));c.emit("chainChanged",u),s==null||s.setItem(q.lastUsedChainId,String(o))}return t.on("accountsChanged",l),t.on("chainChanged",r),t.on("disconnect",d),t.on("session_delete",d),[e,n,i,o=>ue(t,o,s)]}function de(a){var n,t;return((t=(n=a.session)==null?void 0:n.namespaces[H])==null?void 0:t.methods)||[]}function le(a){var t,c,s;return((s=(c=(t=a.session)==null?void 0:t.namespaces[H])==null?void 0:c.chains)==null?void 0:s.map(e=>Number.parseInt(e.split(":")[1]||"")))??[]}async function ue(a,n,t){var s,e;const c=n.id;try{const i=le(a),d=de(a);if(!i.includes(c)&&d.includes(N)){const r=await O(n),o=[...new Set([...((s=n.blockExplorers)==null?void 0:s.map(m=>m.url))||[],...((e=r.explorers)==null?void 0:e.map(m=>m.url))||[]])];await a.request({method:N,params:[{chainId:M(r.chainId),chainName:r.name,nativeCurrency:r.nativeCurrency,rpcUrls:$(r),blockExplorerUrls:o.length>0?o:void 0}]});const u=await he(t);u.push(c),U(u,t)}await a.request({method:"wallet_switchEthereumChain",params:[{chainId:M(c)}]})}catch(i){const d=typeof i=="string"?i:i==null?void 0:i.message;throw/user rejected request/i.test(d)?new P(i):new _(i)}}function U(a,n){n==null||n.setItem(q.requestedChains,JSON.stringify(a))}async function he(a){const n=await a.getItem(q.requestedChains);return n?JSON.parse(n):[]}function V(a){const n={};a.chain&&(n[a.chain.id]=A({chain:a.chain,client:a.client}));const t=((a==null?void 0:a.optionalChains)||[]).slice(0,10);for(const e of t)n[e.id]=A({chain:e,client:a.client});const c=t.map(e=>e.id)||[],s=a.chain?[a.chain.id,...c]:c.length>0?c:[1];return!a.chain&&t.length===0&&(n[1]=C(1).rpc),{rpcMap:n,chainsToRequest:s}}const W=[1,11155111,42161,43114,8453,1313161554,84532,56,42220,100,10,137,1101,324,534352];export{pe as autoConnectWC,me as connectWC};
